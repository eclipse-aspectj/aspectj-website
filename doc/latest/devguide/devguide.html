<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>The AspectJTM Development Environment Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>The AspectJ<sup>TM</sup> Development Environment Guide</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#tools-intro">Introduction to the AspectJ tools</a>
<ul class="sectlevel2">
<li><a href="#eclipse-aspectj">The Eclipse AspectJ implementation</a></li>
<li><a href="#bytecode-concepts">Bytecode weaving, incremental compilation, and memory usage</a></li>
</ul>
</li>
<li><a href="#ajc"><code>ajc</code>, the AspectJ compiler/weaver</a>
<ul class="sectlevel2">
<li><a href="#_name">Name</a></li>
<li><a href="#_synopsis">Synopsis</a></li>
<li><a href="#_description">Description</a></li>
</ul>
</li>
<li><a href="#_ajdoc_the_aspectj_api_documentation_generator"><code>ajdoc</code>, the AspectJ API documentation generator</a>
<ul class="sectlevel2">
<li><a href="#_name_2">Name</a></li>
<li><a href="#_synopsis_2">Synopsis</a></li>
<li><a href="#_description_2">Description</a></li>
<li><a href="#_examples_2">Examples</a></li>
</ul>
</li>
<li><a href="#_aj_the_aspectj_load_time_weaving_launcher"><code>aj</code>, the AspectJ load-time weaving launcher</a>
<ul class="sectlevel2">
<li><a href="#_name_3">Name</a></li>
<li><a href="#_synopsis_3">Synopsis</a></li>
<li><a href="#aj">Description</a></li>
<li><a href="#_examples_3">Examples</a></li>
</ul>
</li>
<li><a href="#antTasks">AspectJ Ant Tasks</a>
<ul class="sectlevel2">
<li><a href="#antTasks-intro">Introduction</a></li>
<li><a href="#antTasks-install">Installing Ant Tasks</a></li>
<li><a href="#antTasks-iajc">AjcTask (iajc)</a></li>
<li><a href="#antTasks-adapter">Ajc11CompilerAdapter (javac)</a></li>
<li><a href="#antTasks-ajc">Ajc10 (ajc)</a></li>
<li><a href="#antTasks-problems">Isolating problems running the Ant tasks</a></li>
</ul>
</li>
<li><a href="#ltw">Load-Time Weaving</a>
<ul class="sectlevel2">
<li><a href="#ltw-introduction">Introduction</a></li>
<li><a href="#ltw-rules">Load-time Weaving Requirements</a></li>
<li><a href="#ltw-configuration">Configuration</a></li>
<li><a href="#ltw-specialcases">Special cases</a></li>
<li><a href="#ltw-packaging">Runtime Requirements for Load-time Weaving</a></li>
<li><a href="#ltw-agents">Supported Agents</a></li>
</ul>
</li>
<li><a href="#compatibility">AspectJ version compatibility</a>
<ul class="sectlevel2">
<li><a href="#versionCompatibility">Version Compatibility</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>by the AspectJ Team</em></p>
</div>
<div class="paragraph">
<p><em>Copyright (c) 1998-2001 Xerox Corporation, 2002 Palo Alto Research Center, Incorporated, 2003-2005 Contributors.
All rights reserved.</em></p>
</div>
<div class="paragraph">
<p>This guide describes how to build and deploy AspectJ programs using the AspectJ tools and facilities. See also the
<a href="../progguide/index.html">AspectJ Programming Guide</a>, the documentation available with the AspectJ support
available for various integrated development environments (e.g. <a href="https://www.eclipse.org/ajdt/">Eclipse AJDT</a>), and the
most-recent documentation available from the <a href="https://eclipse.org/aspectj">AspectJ project page</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tools-intro">Introduction to the AspectJ tools</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="eclipse-aspectj">The Eclipse AspectJ implementation</h3>
<div class="paragraph">
<p>The <a href="../progguide/index.html">AspectJ Programming Guide</a> describes
the AspectJ language. This guide describes the AspectJ tools produced by
the AspectJ team on <a href="https://eclipse.org/aspectj" class="bare">https://eclipse.org/aspectj</a>. The AspectJ tools
include - ajc, the compiler/weaver; ajdoc, a documentation tool;
Ant support for ajc; and load-time weaving support.
These tools are delivered in the library
folder of the AspectJ tools installation, mainly in <code>aspectjtools.jar</code>
(tools) and <code>aspectjrt.jar</code> (runtime). This guide does not describe the
Eclipse AspectJ development tools (AJDT). That is produced by another
team (sharing some members) on
<a href="https://eclipse.org/aspectj">https://eclipse.org/ajdt</a>. AJDT is delivered
as an Eclipse plugin, incorporating the classes in the AspectJ tools
libraries along with the Eclipse plugin interface classes.</p>
</div>
<div class="paragraph">
<p>Since AspectJ 1.1, the tools have implemented the AspectJ language using
bytecode weaving, which combines aspects and classes to produce .class
files that run in a Java VM. There are other ways to implement the
language (e.g., compiler preprocessor, VM support); the AspectJ team has
always tried to distinguish the language and the implementation so other
groups could build alternative implementations of AspectJ. To that end,
<a href="../progguide/implementation.html">The AspectJ Programming Guide,
Implementation Notes</a> describes how the Java bytecode form affects
language semantics. VM- or source-based implementations may be free of
these limits or impose limits of their own, but most should be fairly
close to what&#8217;s possible in Java bytecode.</p>
</div>
<div class="paragraph">
<p>Please be careful not to confuse any description of weaving or of this
implementation of the AspectJ language with the AspectJ language
semantics. If you do, you might find yourself writing code that doesn&#8217;t
work as expected when you compile or run it on other systems. More
importantly, if you think about aspects in terms of weaving or of
inserting or merging code, then you can lose many of the design benefits
of thinking about an aspect as a single crosscutting module. When the
text below introduces an implementation detail, it will warn if users
make mistakes by applying it in lieu of the language semantics.</p>
</div>
</div>
<div class="sect2">
<h3 id="bytecode-concepts">Bytecode weaving, incremental compilation, and memory usage</h3>
<div class="paragraph">
<p>Bytecode weaving takes classes and aspects in .class form and weaves
them together to produce binary-compatible .class files that run in any
Java VM and implement the AspectJ semantics. This process supports not
only the compiler but also IDE&#8217;s. The compiler, given an aspect in
source form, produces a binary aspect and runs the weaver. IDE&#8217;s can get
information about crosscutting in the program by subscribing to
information produced by weaver as a side-effect of weaving.</p>
</div>
<div class="paragraph">
<p>Incremental compilation involves recompiling only what is necessary to
bring the binary form of a program up-to-date with the source form in
the shortest time possible. Incremental weaving supports this by weaving
on a per-class basis. (Some implementations of AOP (including AspectJ
1.0) make use of whole-program analysis that can&#8217;t be done in
incremental mode.) Weaving per-class means that if the source for a pure
Java class is updated, only that class needs to be produced. However, if
some crosscutting specification may have been updated, then all code
potentially affected by it may need to be woven. The AspectJ tools are
getting better at minimizing this effect, but it is to some degree
unavoidable due to the crosscutting semantics.</p>
</div>
<div class="paragraph">
<p>Memory usage can seem higher with AspectJ tools. Some aspects are
written to potentially affect many classes, so each class must be
checked during the process of weaving. Programmers can minimize this by
writing the crosscutting specifications as narrowly as possible while
maintaining correctness. (While it may seem like more memory, the proper
comparison would with with a Java program that had the same
crosscutting, with changes made to each code segment. That would likely
require more memory and more time to recompile than the corresponding
AspectJ program.)</p>
</div>
<div class="sect3">
<h4 id="classpathInpathAndAspectpath">Classpath, inpath, and aspectpath</h4>
<div class="paragraph">
<p>AspectJ introduces two new paths for the binary input to the weaver
which you&#8217;ll find referenced in <a href="#"><code>ajc</code>, the AspectJ compiler/weaver</a>,
<a href="#">AspectJ Ant Tasks</a>, and <a href="#ltw">Load-Time Weaving</a>.</p>
</div>
<div class="paragraph">
<p>As in Java, the <code>classpath</code> is where the AspectJ tools resolve types
specified in the program. When running an AspectJ program, the classpath
should contain the classes and aspects along with the AspectJ runtime
library, <code>aspectjrt.jar</code>.</p>
</div>
<div class="paragraph">
<p>In AspectJ tools, the <code>aspectpath</code> is where to find binary aspects. Like
the classpath, it can include archives (.jar and .zip files) and
directories containing .class files in a package layout (since binary
aspects are in .class files). These aspects affect other classes in
exactly the same way as source-level aspects, but are themselves not
affected. When deploying programs, the original aspects must be included
on the runtime classpath.</p>
</div>
<div class="paragraph">
<p>In AspectJ tools, the <code>inpath</code> is where to find binary input - aspects
and classes that weave and may be woven. Like the classpath, it can
include archives and class directories. Like the aspectpath, it can
include aspects that affect other classes and aspects. However, unlike
the aspectpath, an aspect on the inpath may itself be affected by
aspects, as if the source were all compiled together. When deploying
aspects that were put on the inpath, only the woven output should be on
the runtime classpath.</p>
</div>
<div class="paragraph">
<p>Although types in the inpath and the aspectpath need to be resolved by
the AspectJ tools, you usually do not need to place them on the
classpath because this is done automatically by the compiler/weaver. But
when using the <code>WeavingURLClassLoader</code>, your code must explicitly add
the aspects to the classpath so they can be resolved (as you&#8217;ll see in
the sample code and the <code>aj.bat</code> script).</p>
</div>
<div class="paragraph">
<p>The most common mistake is failing to add <code>aspectjrt.jar</code> to the
classpath. Also, when weaving with binary aspects, users forget to
deploy the aspect itself along with any classes it requires. A more
subtle mistake is putting a binary aspect (BA) on the inpath instead of
the aspectpath. In this case the aspect BA might be affected by an
aspect, even itself; this can cause the program to fail, e.g., when an
aspect uses exclusion to avoid infinite recursion but fails to exclude
advice in aspect BA.</p>
</div>
<div class="paragraph">
<p>The latter is one of many ways that mistakes in the build process can
affect aspects that are written poorly. Aspects should never rely on the
boundaries of the build specification to narrow the scope of their
crosscutting, since the build can be changed without notice to the
aspect developer. Careful users might even avoid relying on the
implementation scope, to ensure their AspectJ code will run on other
implementations.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ajc"><code>ajc</code>, the AspectJ compiler/weaver</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_name">Name</h3>
<div class="paragraph">
<p><code>ajc</code> - compiler and bytecode weaver for the AspectJ and Java languages</p>
</div>
</div>
<div class="sect2">
<h3 id="_synopsis">Synopsis</h3>
<div class="literalblock">
<div class="content">
<pre>ajc [<em>option</em>...] [<em>file</em>... | @<em>file</em>... | -argfile <em>file</em>...]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_description">Description</h3>
<div class="paragraph">
<p>The <code>ajc</code> command compiles and weaves AspectJ and Java source and .class
files, producing .class files compliant with any Java VM (1.1 or later).
It combines compilation and bytecode weaving and supports incremental
builds; you can also weave bytecode at run-time using <a href="#ltw">Load-Time Weaving</a>.</p>
</div>
<div class="paragraph">
<p>The arguments after the options specify the source file(s) to compile.
To specify source classes, use <code>-inpath</code> (below). Files may be listed
directly on the command line or in a file. The <code>-argfile file</code> and
<code>@file</code> forms are equivalent, and are interpreted as meaning all the
arguments listed in the specified file.</p>
</div>
<div class="paragraph">
<p><code>Note:</code> You must explicitly pass <code>ajc</code> all necessary sources. Be sure to
include the source not only for the aspects or pointcuts but also for
any affected types. Specifying all sources is necessary because, unlike
javac, ajc does not search the sourcepath for classes. (For a discussion
of what affected types might be required, see
<a href="../progguide/implementation.html">The AspectJ Programming Guide,
Implementation Appendix</a>.)</p>
</div>
<div class="paragraph">
<p>To specify sources, you can list source files as arguments or use the
options <code>-sourceroots</code> or <code>-inpath</code>. If there are multiple sources for
any type, the result is undefined since ajc has no way to determine
which source is correct. (This happens most often when users include the
destination directory on the inpath and rebuild.)</p>
</div>
<div class="sect3">
<h4 id="ajc_options">Options</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-injars &lt;JarList&gt;</code></dt>
<dd>
<p>deprecated: since 1.2, use <code>-inpath</code>, which also takes directories.</p>
</dd>
<dt class="hdlist1"><code>-inpath &lt;Path&gt;</code></dt>
<dd>
<p>Accept as source bytecode any .class files in the .jar files or
directories on Path. The output will include these classes, possibly
as woven with any applicable aspects. Path is a single argument
containing a list of paths to zip files or directories, delimited by
the platform-specific path delimiter.</p>
</dd>
<dt class="hdlist1"><code>-aspectpath &lt;Path&gt;</code></dt>
<dd>
<p>Weave binary aspects from jar files and directories on path into all
sources. The aspects should have been output by the same version of
the compiler. When running the output classes, the run classpath
should contain all aspectpath entries. Path, like classpath, is a
single argument containing a list of paths to jar files, delimited by
the platform-specific classpath delimiter.</p>
</dd>
<dt class="hdlist1"><code>-argfile &lt;File&gt;</code></dt>
<dd>
<p>The file contains a line-delimited list of arguments. Each line in the
file should contain one option, filename, or argument string (e.g., a
classpath or inpath). Arguments read from the file are inserted into
the argument list for the command. Relative paths in the file are
calculated from the directory containing the file (not the current
working directory). Comments, as in Java, start with <code>//</code> and extend
to the end of the line. Options specified in argument files may
override rather than extending existing option values, so avoid
specifying options like <code>-classpath</code> in argument files unlike the
argument file is the only build specification. The form <code>@file</code> is the
same as specifying <code>-argfile file</code>.</p>
</dd>
<dt class="hdlist1"><code>-outjar &lt;output.jar&gt;</code></dt>
<dd>
<p>Put output classes in zip file output.jar.</p>
</dd>
<dt class="hdlist1"><code>-outxml</code></dt>
<dd>
<p>Generate aop.xml file for load-time weaving with default name.</p>
</dd>
<dt class="hdlist1"><code>-outxmlfile &lt;custom/aop.xml&gt;</code></dt>
<dd>
<p>Generate aop.xml file for load-time weaving with custom name.</p>
</dd>
<dt class="hdlist1"><code>-incremental</code></dt>
<dd>
<p>Run the compiler continuously. After the initial compilation, the
compiler will wait to recompile until it reads a newline from the
standard input, and will quit when it reads a 'q'. It will only
recompile necessary components, so a recompile should be much faster
than doing a second compile. This requires <code>-sourceroots</code>.</p>
</dd>
<dt class="hdlist1"><code>-sourceroots &lt;DirPaths&gt;</code></dt>
<dd>
<p>Find and build all .java or .aj source files under any directory
listed in DirPaths. DirPaths, like classpath, is a single argument
containing a list of paths to directories, delimited by the platform-specific
classpath delimiter. Required by <code>-incremental</code>.</p>
</dd>
<dt class="hdlist1"><code>-xmlConfigured &lt;files&gt;</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Configure the compile-time weaving (CTW) process, if you wish to impose non-standard limitations, e.g. a list of aspects
to use (if not all), global and per-aspect scopes for the weaver (target packages and classes to exclude or include).
This option also needs an .xml file on the command line, optionally multiple ones to be logically merged into one weaver
configuration. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aspectj&gt;</span>
  <span class="comment">&lt;!-- From all aspects found, only use the ones listed here --&gt;</span>
  <span class="tag">&lt;aspects&gt;</span>
    <span class="comment">&lt;!-- Only weave class org.acme.app.B --&gt;</span>
    <span class="tag">&lt;aspect</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">a.b.OneAspect</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.acme.app.B</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="comment">&lt;!-- Only weave classes in package org.acme and its sub-packages --&gt;</span>
    <span class="tag">&lt;aspect</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">c.d.TwoAspect</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.acme..*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="comment">&lt;!-- Weave all classes, unless globally excluded --&gt;</span>
    <span class="tag">&lt;aspect</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">e.f.ThreeAspect</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="comment">&lt;!-- Weave all classes below org.acme.service, but not in the audit sub-package --&gt;</span>
    <span class="tag">&lt;aspect</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">e.f.FourAspect</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.acme.service..* AND !*..audit.*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="comment">&lt;!-- Weave all controllers and services --&gt;</span>
    <span class="tag">&lt;aspect</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">e.f.FiveAspect</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*..*Controller || *..*Service</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/aspects&gt;</span>
  <span class="tag">&lt;weaver&gt;</span>
    <span class="comment">&lt;!-- Globally exclude classes in package org.acme.internal and its sub-packages from weaving --&gt;</span>
    <span class="tag">&lt;exclude</span> <span class="attribute-name">within</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.acme.internal..*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="comment">&lt;!-- This has **no effect**, use per-aspect scopes instead --&gt;</span>
    <span class="tag">&lt;include</span> <span class="attribute-name">within</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz..*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/weaver&gt;</span>
<span class="tag">&lt;/aspectj&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note, that <code>-xmlConfigured</code> works similarly to load-time weaving (LTW) configuration with <em>aop.xml</em>, but not 100%
identically:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is <strong>no magical file name</strong> like <em>aop.xml</em> for LTW, i.e. an XML configuration file for CTW needs to be
specified on the command line explicitly.</p>
</li>
<li>
<p>In the <code>&lt;weaver&gt;</code> section, <code>&lt;include within="&#8230;&#8203;"/&gt;</code> is ignored (see example above), because in CTW mode all
classes the compiler can see are implicitly included in weaving, unless explicitly excluded.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Limitations which apply to both LTW and CTW modes include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Scopes and excludes only affect regular pointcuts (e.g. method interception), not ITDs. The latter will always be
applied and are unaffected by XML configuration.</p>
</li>
<li>
<p>When using logical operators, you cannot write <code>&amp;&amp;</code> in XML. Instead, use <code>AND</code> as a replacement. The operators <code>||</code>
and <code>!</code> can be used normally. Complex expressions like <code>(A||B||C) AND !D</code> are also permitted.</p>
</li>
<li>
<p>If you want to apply a scope to an aspect extending an abstract base aspect, you need to list and scope both aspects
in the XML file.</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>-crossrefs</code></dt>
<dd>
<p>Generate a build .ajsym file into the output directory. Used for
viewing crosscutting references by tools like the AspectJ Browser.</p>
</dd>
<dt class="hdlist1"><code>-emacssym</code></dt>
<dd>
<p>Generate .ajesym symbol files for emacs support (deprecated).</p>
</dd>
<dt class="hdlist1"><code>-Xlint</code></dt>
<dd>
<p>Same as -Xlint:warning (enabled by default)</p>
</dd>
<dt class="hdlist1"><code>-Xlint:{level}</code></dt>
<dd>
<p>Set default level for messages about potential programming mistakes in
crosscutting code. <code>{level}</code> may be <code>ignore</code>, <code>warning</code>, or <code>error</code>. This
overrides entries in <em>org/aspectj/weaver/XlintDefault.properties</em> from
aspectjtools.jar, but does not override levels set using the
<code>-Xlintfile</code> option.</p>
</dd>
<dt class="hdlist1"><code>-Xlintfile &lt;PropertyFile&gt;</code></dt>
<dd>
<p>Specify properties file to set levels for specific crosscutting
messages. PropertyFile is a path to a Java .properties file that takes
the same property names and values as
<em>org/aspectj/weaver/XlintDefault.properties</em> from aspectjtools.jar,
which it also overrides.</p>
</dd>
<dt class="hdlist1"><code>-help</code></dt>
<dd>
<p>Emit information on compiler options and usage</p>
</dd>
<dt class="hdlist1"><code>-version</code></dt>
<dd>
<p>Emit the version of the AspectJ compiler</p>
</dd>
<dt class="hdlist1"><code>-classpath &lt;Path&gt;</code></dt>
<dd>
<p>Specify where to find user class files. Path is a single argument
containing a list of paths to zip files or directories, delimited by
the platform-specific path delimiter.</p>
</dd>
<dt class="hdlist1"><code>-bootclasspath &lt;Path&gt;</code></dt>
<dd>
<p>Override location of VM&#8217;s bootclasspath for purposes of evaluating
types when compiling. Path is a single argument containing a list of
paths to zip files or directories, delimited by the platform-specific
path delimiter.</p>
</dd>
<dt class="hdlist1"><code>-extdirs &lt;Path&gt;</code></dt>
<dd>
<p>Override location of VM&#8217;s extension directories for purposes of
evaluating types when compiling. Path is a single argument containing
a list of paths to directories, delimited by the platform-specific
path delimiter.</p>
</dd>
<dt class="hdlist1"><code>-d &lt;Directory&gt;</code></dt>
<dd>
<p>Specify where to place generated .class files. If not specified,
&lt;Directory&gt; defaults to the current working dir.</p>
</dd>
</dl>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-source &lt;[1.3 to 21]&gt;</code></dt>
<dd>
<p>Set source file Java language level</p>
</dd>
<dt class="hdlist1"><code>-target &lt;[1.3 to 21]&gt;</code></dt>
<dd>
<p>Set classfile Java bytecode level</p>
</dd>
<dt class="hdlist1"><code>-&lt;[1.3 to 21]&gt;</code></dt>
<dd>
<p>Set compiler compliance level. Implies identical <code>-source</code> and <code>-target</code> levels.
E.g., <code>-11</code> implies <code>-source 11</code> and <code>-target 11</code>.</p>
</dd>
<dt class="hdlist1"><code>-nowarn</code></dt>
<dd>
<p>Emit no warnings (equivalent to <code>-warn:none</code>) This does not suppress
messages generated by <code>declare warning</code> or <code>Xlint</code>.</p>
</dd>
<dt class="hdlist1"><code>-warn: &lt;items&gt;</code></dt>
<dd>
<p>Emit warnings for any instances of the comma-delimited list of
questionable code (e.g. <code>-warn:unusedLocals,deprecation</code>):</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">constructorName        method with constructor name
packageDefaultMethod   attempt to override package-default method
deprecation            usage of deprecated type or member
maskedCatchBlocks      hidden catch block
unusedLocals           local variable never read
unusedArguments        method argument never read
unusedImports          import statement not used by code in file
none                   suppress all compiler warnings</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>-warn:none</code> does not suppress messages generated by <code>declare warning</code>
  or <code>Xlint</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code>-deprecation</code></dt>
<dd>
<p>Same as <code>-warn:deprecation</code></p>
</dd>
<dt class="hdlist1"><code>-noImportError</code></dt>
<dd>
<p>Emit no errors for unresolved imports</p>
</dd>
<dt class="hdlist1"><code>-proceedOnError</code></dt>
<dd>
<p>Keep compiling after error, dumping class files with problem methods</p>
</dd>
<dt class="hdlist1"><code>-g&lt;:[lines,vars,source]&gt;</code></dt>
<dd>
<p>debug attributes level, that may take three forms:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">-g         all debug info ('-g:lines,vars,source')
-g:none    no debug info
-g:{items} debug info for any/all of [lines, vars, source], e.g.,
           -g:lines,source</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1"><code>-preserveAllLocals</code></dt>
<dd>
<p>Preserve all local variables during code generation (to facilitate
debugging).</p>
</dd>
<dt class="hdlist1"><code>-referenceInfo</code></dt>
<dd>
<p>Compute reference information.</p>
</dd>
<dt class="hdlist1"><code>-encoding &lt;format&gt;</code></dt>
<dd>
<p>Specify default source encoding format. Specify custom encoding on a
per-file basis by suffixing each input source file/folder name with
'[encoding]'.</p>
</dd>
<dt class="hdlist1"><code>-verbose</code></dt>
<dd>
<p>Emit messages about accessed/processed compilation units</p>
</dd>
<dt class="hdlist1"><code>-showWeaveInfo</code></dt>
<dd>
<p>Emit messages about weaving</p>
</dd>
<dt class="hdlist1"><code>-log &lt;file&gt;</code></dt>
<dd>
<p>Specify a log file for compiler messages.</p>
</dd>
<dt class="hdlist1"><code>-progress</code></dt>
<dd>
<p>Show progress (requires -log mode).</p>
</dd>
<dt class="hdlist1"><code>-time</code></dt>
<dd>
<p>Display speed information.</p>
</dd>
<dt class="hdlist1"><code>-noExit</code></dt>
<dd>
<p>Do not call <code>System.exit(n)</code> at end of compilation (n=0 if no error)</p>
</dd>
<dt class="hdlist1"><code>-repeat &lt;N&gt;</code></dt>
<dd>
<p>Repeat compilation process N times (typically to do performance
analysis).</p>
</dd>
<dt class="hdlist1"><code>-XterminateAfterCompilation</code></dt>
<dd>
<p>Causes compiler to terminate before weaving</p>
</dd>
<dt class="hdlist1"><code>-XaddSerialVersionUID</code></dt>
<dd>
<p>Causes the compiler to calculate and add the SerialVersionUID field to
any type implementing Serializable that is affected by an aspect. The
field is calculated based on the class before weaving has taken place.</p>
</dd>
<dt class="hdlist1"><code>-Xreweavable[:compress]</code></dt>
<dd>
<p>(Experimental - deprecated as now default) Runs weaver in reweavable
mode which causes it to create woven classes that can be rewoven,
subject to the restriction that on attempting a reweave all the types
that advised the woven type must be accessible.</p>
</dd>
<dt class="hdlist1"><code>-XnoInline</code></dt>
<dd>
<p>(Experimental) do not inline around advice</p>
</dd>
<dt class="hdlist1"><code>-XincrementalFile &lt;file&gt;</code></dt>
<dd>
<p>(Experimental) This works like incremental mode, but using a file
rather than standard input to control the compiler. It will recompile
each time file is changed and and halt when file is deleted.</p>
</dd>
<dt class="hdlist1"><code>-XserializableAspects</code></dt>
<dd>
<p>(Experimental) Normally it is an error to declare aspects
Serializable. This option removes that restriction.</p>
</dd>
<dt class="hdlist1"><code>-XnotReweavable</code></dt>
<dd>
<p>(Experimental) Create class files that can&#8217;t be subsequently rewoven
by AspectJ.</p>
</dd>
<dt class="hdlist1"><code>-Xajruntimelevel:1.2, ajruntimelevel:1.5</code></dt>
<dd>
<p>(Experimental) Allows code to be generated that targets a 1.2 or a 1.5
level AspectJ runtime (default 1.5)</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_file_names">File names</h4>
<div class="paragraph">
<p>ajc accepts source files with either the <code>.java</code> extension or the <code>.aj</code>
extension. We normally use <code>.java</code> for all of our files in an AspectJ
system&#8201;&#8212;&#8201;files that contain aspects as well as files that contain
classes. However, if you have a need to mechanically distinguish files
that use AspectJ&#8217;s additional functionality from those that are pure
Java we recommend using the <code>.aj</code> extension for those files.</p>
</div>
<div class="paragraph">
<p>We&#8217;d like to discourage other means of mechanical distinction such as
naming conventions or sub-packages in favor of the <code>.aj</code> extension.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Filename conventions are hard to enforce and lead to awkward names for
your aspects. Instead of <code>TracingAspect.java</code> we recommend using
<code>Tracing.aj</code> (or just <code>Tracing.java</code>) instead.</p>
</li>
<li>
<p>Sub-packages move aspects out of their natural place in a system and
can create an artificial need for privileged aspects. Instead of adding
a sub-package like <code>aspects</code> we recommend using the <code>.aj</code> extension and
including these files in your existing packages instead.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_compatibility">Compatibility</h4>
<div class="paragraph">
<p>AspectJ is a compatible extension to the Java programming language. The
AspectJ compiler adheres to the
<a href="https://java.sun.com/docs/books/jls/index.html">The Java Language
Specification, Second Edition</a> and to the
<a href="https://java.sun.com/docs/books/vmspec/index.html">The Java Virtual
Machine Specification, Second Edition</a> and runs on any Java 2 compatible
platform. The code it generates runs on any Java 1.1 or later compatible
platform. For more information on compatibility with Java and with
previous releases of AspectJ, see <a href="#versionCompatibility">Version Compatibility</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_examples">Examples</h4>
<div class="paragraph">
<p>Compile two files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">ajc HelloWorld.java Trace.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>To avoid specifying file names on the command line, list source files in
a line-delimited text argfile. Source file paths may be absolute or
relative to the argfile, and may include other argfiles by @-reference.
The following file <code>sources.lst</code> contains absolute and relative files
and @-references:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">Gui.java
/home/user/src/Library.java
data/Repository.java
data/Access.java
@../../common/common.lst
@/home/user/src/lib.lst
view/body/ArrayView.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>Compile the files using either the -argfile or @ form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">ajc -argfile sources.lst
ajc @sources.lst</code></pre>
</div>
</div>
<div class="paragraph">
<p>Argfiles are also supported by jikes and javac, so you can use the files
in hybrid builds. However, the support varies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only ajc accepts command-line options</p>
</li>
<li>
<p>Jikes and Javac do not accept internal @argfile references.</p>
</li>
<li>
<p>Jikes and Javac only accept the @file form on the command line.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Bytecode weaving using -inpath: AspectJ 1.2 supports weaving .class
files in input zip/jar files and directories. Using input jars is like
compiling the corresponding source files, and all binaries are emitted
to output. Although Java-compliant compilers may differ in their output,
ajc should take as input any class files produced by javac, jikes,
eclipse, and, of course, ajc. Aspects included in -inpath will be woven
into like other .class files, and they will affect other types as usual.</p>
</div>
<div class="paragraph">
<p>Aspect libraries using -aspectpath: AspectJ 1.1 supports weaving from
read-only libraries containing aspects. Like input jars, they affect all
input; unlike input jars, they themselves are not affected or emitted as
output. Sources compiled with aspect libraries must be run with the same
aspect libraries on their classpath.</p>
</div>
<div class="paragraph">
<p>The following example builds the tracing example in a command-line
environment; it creates a read-only aspect library, compiles some
classes for use as input bytecode, and compiles the classes and other
sources with the aspect library.</p>
</div>
<div class="paragraph">
<p>The tracing example is in the AspectJ distribution
({aspectj}/doc/examples/tracing). This uses the following files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">aspectj1.1/
  bin/
    ajc
  lib/
    aspectjrt.jar
  examples/
    tracing/
      Circle.java
      ExampleMain.java
      lib/
        AbstractTrace.java
        TraceMyClasses.java
      notrace.lst
      Square.java
      tracelib.lst
      tracev3.lst
      TwoDShape.java
      version3/
        Trace.java
        TraceMyClasses.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>Below, the path separator is taken as ";", but file separators are "/".
All commands are on one line. Adjust paths and commands to your
environment as needed.</p>
</div>
<div class="paragraph">
<p>Setup the path, classpath, and current directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">cd examples
export ajrt=../lib/aspectjrt.jar
export CLASSPATH=&quot;$ajrt&quot;
export PATH=&quot;../bin:$PATH&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Build a read-only tracing library:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">ajc -argfile tracing/tracelib.lst -outjar tracelib.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Build the application with tracing in one step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">ajc -aspectpath tracelib.jar -argfile tracing/notrace.lst -outjar tracedapp.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the application with tracing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">java -classpath &quot;$ajrt;tracedapp.jar;tracelib.jar&quot; tracing.ExampleMain</code></pre>
</div>
</div>
<div class="paragraph">
<p>Build the application with tracing from binaries in two steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(a) Build the application classes (using javac for
demonstration&#8217;s sake):</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">mkdir classes
javac -d classes tracing/*.java
jar cfM app.jar -C classes .</code></pre>
</div>
</div>
</li>
<li>
<p>(b) Build the application with tracing:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">ajc -inpath app.jar -aspectpath tracelib.jar -outjar tracedapp.jar</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Run the application with tracing (same as above):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">java -classpath &quot;$ajrt;tracedapp.jar;tracelib.jar&quot; tracing.ExampleMain</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the application without tracing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">java -classpath &quot;app.jar&quot; tracing.ExampleMain</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_aspectj_compiler_api">The AspectJ compiler API</h4>
<div class="paragraph">
<p>The AspectJ compiler is implemented completely in Java and can be called
as a Java class. The only interface that should be considered public are
the public methods in <code>org.aspectj.tools.ajc.Main</code>. E.g.,
<code>main(String[] args)</code> takes the the standard <code>ajc</code> command line
arguments. This means that an alternative way to run the compiler is</p>
</div>
<div class="literalblock">
<div class="content">
<pre>java org.aspectj.tools.ajc.Main [<em>option</em>...] [<em>file</em>...]</pre>
</div>
</div>
<div class="paragraph">
<p>To access compiler messages programmatically, use the methods
<code>setHolder(IMessageHolder holder)</code> and/or
<code>run(String[] args, IMessageHolder holder)</code>. <code>ajc</code> reports each message
to the holder using <code>IMessageHolder.handleMessage(..)</code>. If you just want
to collect the messages, use <code>MessageHandler</code> as your <code>IMessageHolder</code>.
For example, compile and run the following with <code>aspectjtools.jar</code> on
the classpath:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.aspectj.bridge</span>.*;
<span class="keyword">import</span> <span class="include">org.aspectj.tools.ajc.Main</span>;
<span class="keyword">import</span> <span class="include">java.util.Arrays</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">WrapAjc</span> {
  <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
    Main compiler = <span class="keyword">new</span> Main();
    MessageHandler m = <span class="keyword">new</span> MessageHandler();
    compiler.run(args, m);
    IMessage<span class="type">[]</span> ms = m.getMessages(<span class="predefined-constant">null</span>, <span class="predefined-constant">true</span>);
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">messages: </span><span class="delimiter">&quot;</span></span> + <span class="predefined-type">Arrays</span>.asList(ms));
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_stack_traces_and_the_sourcefile_attribute">Stack Traces and the SourceFile attribute</h4>
<div class="paragraph">
<p>Unlike traditional java compilers, the AspectJ compiler may in certain
cases generate classfiles from multiple source files. Unfortunately, the
original Java class file format does not support multiple SourceFile
attributes. In order to make sure all source file information is
available, the AspectJ compiler may in some cases encode multiple
filenames in the SourceFile attribute. When the Java VM generates stack
traces, it uses this attribute to specify the source file.</p>
</div>
<div class="paragraph">
<p>(The AspectJ 1.0 compiler also supports the .class file extensions of
JSR-45. These permit compliant debuggers (such as jdb in Java 1.4.1) to
identify the right file and line even given many source files for a
single class. JSR-45 support is planned for ajc in AspectJ 1.1, but is
not in the initial release. To get fully debuggable .class files, use
the -XnoInline option.)</p>
</div>
<div class="paragraph">
<p>Probably the only time you may see this format is when you view stack
traces, where you may encounter traces of the format</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">java.lang.NullPointerException
  at Main.new$constructor_call37(Main.java;SynchAspect.java[1k]:1030)</code></pre>
</div>
</div>
<div class="paragraph">
<p>where instead of the usual</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">File:LineNumber</code></pre>
</div>
</div>
<div class="paragraph">
<p>format, you see</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">File0;File1[Number1];File2[Number2] ... :LineNumber</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, LineNumber is the usual offset in lines plus the "start
line" of the actual source file. That means you use LineNumber both to
identify the source file and to find the line at issue. The number in
[brackets] after each file tells you the virtual "start line" for that
file (the first file has a start of 0).</p>
</div>
<div class="paragraph">
<p>In our example from the null pointer exception trace, the virtual start
line is 1030. Since the file SynchAspect.java "starts" at line 1000
[1k], the LineNumber points to line 30 of SynchAspect.java.</p>
</div>
<div class="paragraph">
<p>So, when faced with such stack traces, the way to find the actual source
location is to look through the list of "start line" numbers to find the
one just under the shown line number. That is the file where the source
location can actually be found. Then, subtract that "start line" from
the shown line number to find the actual line number within that file.</p>
</div>
<div class="paragraph">
<p>In a class file that comes from only a single source file, the AspectJ
compiler generates SourceFile attributes consistent with traditional
Java compilers.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ajdoc_the_aspectj_api_documentation_generator"><code>ajdoc</code>, the AspectJ API documentation generator</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_name_2">Name</h3>
<div class="paragraph">
<p><code>ajdoc</code> - generate HTML API documentation, including crosscutting structure</p>
</div>
</div>
<div class="sect2">
<h3 id="_synopsis_2">Synopsis</h3>
<div class="literalblock">
<div class="content">
<pre>ajdoc [ -bootclasspath <em>classpathlist</em> ] [ -classpath <em>classpathlist</em> ] [-d <em>path</em>] [-help] [-package] [-protected] [-private] [-public] [-overview <em>overviewFile</em>] [ -sourcepath <em>sourcepathlist</em> ] [-verbose] [-version] [<em>sourcefiles</em>... | <em>packages</em>... | @<em>file</em>... | -argfile <em>file</em>...] [ <em>ajc options</em> ]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_description_2">Description</h3>
<div class="paragraph">
<p><code>ajdoc</code> renders HTML documentation for AspectJ constructs as well as the
Java constructs that <code>javadoc</code> renders. In addition <code>ajdoc</code> displays the
crosscutting nature in the form of links. That means, for example, that
you can see everything affecting a method when reading the documentation
for the method.</p>
</div>
<div class="paragraph">
<p>To run <code>ajdoc</code>, use one of the scripts in the AspectJ <code>bin</code> directory.
The <code>ajdoc</code> implementation builds on Sun&#8217;s <code>javadoc</code> command line tool,
and you use it in the same way with many of the same options (<code>javadoc</code>
options are not documented here; for more information on <code>javadoc</code>
usage, see the <a href="https://java.sun.com/j2se/javadoc/">Javadoc homepage</a>.)</p>
</div>
<div class="paragraph">
<p>As with <code>ajc</code> (but unlike <code>javadoc</code>), you pass <code>ajdoc</code> all your aspect
source files and any files containing types affected by the aspects;
it&#8217;s often easiest to just pass all the <code>.java</code> and <code>.aj</code> files in your
system. Unlike <code>ajc</code>, <code>ajdoc</code> will try to find package sources using the
specified sourcepath if you list packages on the command line.</p>
</div>
<div class="paragraph">
<p>To provide an argfile listing the source files, you can use use the same
argfile (<code>@filename</code>) conventions as with <code>ajc</code>. For example, the
following documents all the source files listed in <code>argfile.lst</code>,
sending the output to the <code>docDir</code> output directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">ajdoc -d docDir @argfile.lst</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#"><code>ajc</code>, the AspectJ compiler/weaver</a> for details on the text file
format.</p>
</div>
<div class="paragraph">
<p><code>ajdoc</code> honours <code>ajc</code> options. See the <a href="#ajc_options">ajc
documentation</a> for details on these options.</p>
</div>
<div class="paragraph">
<p><code>ajdoc</code> currently requires the <code>tools.jar</code> from J2SE 1.3 to be on the
classpath. Normally the scripts set this up, assuming that your
<code>JAVA_HOME</code> variable points to an appropriate installation of Java. You
may need to provide this jar when using a different version of Java or a
JRE.</p>
</div>
</div>
<div class="sect2">
<h3 id="_examples_2">Examples</h3>
<div class="ulist">
<ul>
<li>
<p>Change into the <code>examples</code> directory.</p>
</li>
<li>
<p>Type <code>mkdir doc</code> to create the destination directory for the documentation.</p>
</li>
<li>
<p>Type <code>ajdoc -private -d doc spacewar coordination</code> to generate the documentation. (Use <code>-private</code> to get all members,
since many of the interesting ones in spacewar are not public.)</p>
</li>
<li>
<p>Type <code>ajdoc -private -d doc @spacewar/demo.lst</code> to use the argfile associated with Spacewar.</p>
</li>
<li>
<p>To view the documentation, open the file <code>index.html</code> in the <code>doc</code> directory using a web browser.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_aj_the_aspectj_load_time_weaving_launcher"><code>aj</code>, the AspectJ load-time weaving launcher</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_name_3">Name</h3>
<div class="paragraph">
<p><code>aj</code> - command-line launcher for basic load-time weaving</p>
</div>
</div>
<div class="sect2">
<h3 id="_synopsis_3">Synopsis</h3>
<div class="paragraph">
<p>aj [<em>Options</em>] [<em>arg</em>&#8230;&#8203;]</p>
</div>
</div>
<div class="sect2">
<h3 id="aj">Description</h3>
<div class="paragraph">
<p>The <code>aj</code> command runs Java programs in Java 1.4 or later by setting up
<code>WeavingURLClassLoader</code> as the system class loader, to do load-time
bytecode weaving.</p>
</div>
<div class="paragraph">
<p>The arguments are the same as those used to launch the Java program.
Users should define the environment variables <code>CLASSPATH</code> and
<code>ASPECTPATH</code>.</p>
</div>
<div class="paragraph">
<p>For more information and alternatives for load-time weaving, see
<a href="#ltw">Load-Time Weaving</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_examples_3">Examples</h3>
<div class="paragraph">
<p>Use ajc to build a library, then weave at load time</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">REM compile library
${ASPECTJ_HOME}\bin\ajc.bat -outjar lib\aspects.jar @aspects.lst

REM run, weaving into application at load-time set
ASPECTPATH=lib\aspects.jar set CLASSPATH=app\app.jar
${ASPECTJ_HOME}\bin\aj.bat com.company.app.Main &quot;Hello, World!&quot;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="antTasks">AspectJ Ant Tasks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="antTasks-intro">Introduction</h3>
<div class="paragraph">
<p>AspectJ contains a compiler, <code>ajc</code>, that can be run from Ant. Included
in the <code>aspectjtools.jar</code> are Ant binaries to support three ways of
running the compiler:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#antTasks-iajc">AjcTask (iajc)</a>, a task to run the AspectJ
post-1.1 compiler, which supports all the eclipse and ajc options,
including incremental mode.</p>
</li>
<li>
<p><a href="#antTasks-adapter">Ajc11CompilerAdapter (javac)</a>, an adapter class
to run the new compiler using Javac tasks by setting the build.compiler
property</p>
</li>
<li>
<p><a href="#antTasks-ajc">Ajc10 (ajc)</a>, a task to run build scripts
compatible with the AspectJ 1.0 tasks</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This describes how to install and use the tasks and the adapter. For an
example Ant script, see <a href="../examples/build.xml">examples/build.xml</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="antTasks-install">Installing Ant Tasks</h3>
<div class="paragraph">
<p>Install Jakarta Ant 1.5.1: Please see the official Jakarta Ant website
for more information and the 1.5.1 distribution. This release is
source-compatible with Ant 1.3 and Ant 1.4, but the task sources must be
compiled with those versions of the Ant libraries to be used under those
versions of Ant. Sources are available under the Eclipse Public License
v 2.0 at <a href="https://eclipse.org/aspectj" class="bare">https://eclipse.org/aspectj</a>.</p>
</div>
<div class="paragraph">
<p>In Ant 1.5, third-party tasks can be declared using a taskdef entry in
the build script, to identify the name and classes. When declaring a
task, include the <code>aspectjtools.jar</code> either in the taskdef classpath or
in <code>${ANT_HOME}/lib</code> where it will be added to the system class path by
the ant script. You may specify the task script names directly, or use
the "resource" attribute to specify the default names:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;taskdef</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org/aspectj/tools/ant/taskdefs/aspectjTaskdefs.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The current resource file retains the name "ajc" for the Ajc10 task, and
uses "iajc" for the AspectJ post-1.1 task.</p>
</div>
<div class="paragraph">
<p>In Ant 1.6, third-party tasks are declared in their own namespace using
<code>antlib.xml</code>. For example, the following script would build and run the
spacewar example, if you put the script in the examples directory and
<code>aspectjtools.jar</code> in the <code>${ANT_HOME}/lib</code> directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;project</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aspectj-ant1.6</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">spacewar</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:aspectj</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">antlib:org.aspectj</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">basedir</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">.</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;target</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">spacewar</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;aspectj:iajc</span>
            <span class="attribute-name">argfiles</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">spacewar/debug.lst</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">outjar</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">spacewar.jar</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">classpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">../../lib/aspectjrt.jar</span><span class="delimiter">&quot;</span></span>
       <span class="tag">/&gt;</span>
       <span class="tag">&lt;java</span> <span class="attribute-name">classname</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">spacewar.Game</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">classpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">spacewar.jar:../../lib/aspectjrt.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/target&gt;</span>
<span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on using Ant, please refer to Jakarta&#8217;s
documentation on integrating user-defined Ant tasks into builds.</p>
</div>
</div>
<div class="sect2">
<h3 id="antTasks-iajc">AjcTask (iajc)</h3>
<div class="paragraph">
<p>This task uses the AspectJ post-1.1 compiler ajc. The AspectJ compiler
can be used like Javac to compile Java sources, but it can also compile
AspectJ sources or weave binary aspects with Java bytecode. It can run
in normal "batch" mode or in an "incremental" mode, where it only
recompiles files it has to revisit. For more information on ajc, see
<a href="#"><code>ajc</code>, the AspectJ compiler/weaver</a>. Unlike Javac or the Javac Ant task, this task always
compiles the specified files since aspects can apply to other (updated)
files. For a workaround, see <a href="#antTasks-iajc-uptodate">Avoiding clean
compiles</a>.</p>
</div>
<div class="paragraph">
<p>Beyond the normal ajc compiler options, this task also supports an
experimental option for an incremental "tag" file, and it can copy
resources from source directories or input jars to the output jar or
directory.</p>
</div>
<div class="paragraph">
<p>This task is named iajc to avoid conflict with the 1.0 task ajc.</p>
</div>
<div class="sect3">
<h4 id="antTasks-iajc-options">AjcTask (iajc) Options</h4>
<div class="paragraph">
<p>The following tables list the supported parameters. For any parameter
specified as a Path, a single path can be specified directly as an
attribute, multiple paths can be specified using a nested element of the
same name, and a common path can be reused by defining it as a global
and passing the id to the corresponding {name}ref attribute. See
<a href="#antTasks-iajc-paths">Path</a> below for more details.</p>
</div>
<div class="paragraph">
<p>Most attributes and nested elements are optional. The compiler requires
that the same version of <code>aspectjrt.jar</code> be specified on the classpath,
and that some sources be be specified (using one or more of
<code>sourceroots</code>, <code>injars</code>, <code>inpath</code>, <code>argfiles</code>, and/or <code>srcdir</code> (with
patterns)). When in incremental mode, only <code>sourceroots</code> may be
specified.</p>
</div>
<div class="paragraph">
<p>Boolean parameters default to <code>false</code> unless otherwise stated.</p>
</div>
<div class="paragraph">
<p><strong>AjcTask (iajc) options for specifying sources</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">argfiles, argfilesRef (<a href="#antTasks-iajc-paths">Path</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An argument
file contains a list of arguments read by the compiler. Each line is
read into one element of the argument array and may include another
argfile by reference.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sourceRoots, sourceRootsRef (<a href="#antTasks-iajc-paths">Path</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directories containing source files (ending with .java or .aj) to
compile.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">srcdir (<a href="#antTasks-iajc-paths">Path</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base directory of sources to
compile, assuming there are <a href="#antTasks-nested-includes">nested
matches</a>. This approach uses the Ant process for matching .java files
and is not compatible with incremental mode. Unless using filters to
limit the sources included, use sourceroots instead.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">injars, injarsRef (<a href="#antTasks-iajc-paths">Path</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deprecated - use
inpath instead. Read .class files for bytecode weaving from zip files
(only).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">inpath, inpathRef (<a href="#antTasks-iajc-paths">Path</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read .class files
for bytecode weaving from directories or zip files (like classpath).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">classpath, classpathRef (<a href="#antTasks-iajc-paths">Path</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The
classpath used by the sources being compiled. When compiling aspects,
include the same version of the <code>aspectjrt.jar</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootclasspath, bootclasspathRef (<a href="#antTasks-iajc-paths">Path</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The
bootclasspath specifies types to use instead of the invoking VM&#8217;s when
seeking types during compilation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">extDirs, extDirsRef (<a href="#antTasks-iajc-paths">Path</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The extension
directories to use instead of those in the invoking VM when seeking
types during compilation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">aspectPath, aspectPathRef (<a href="#antTasks-iajc-paths">Path</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to
classpath, aspectpath contains read-only, binary aspect libraries that
are woven into sources but not included in the output. <code>aspectpath</code>
accepts jar/zip files (but, unlike classpath, not directories).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>AjcTask (iajc) options for specifying output</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">destDir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The directory in which to place the generated class files.
Only one of <code>destDir</code> and <code>outJar</code> may be set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">outJar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The zip file in which to place the generated output class
files. Only one of <code>destDir</code> and <code>outJar</code> may be set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyInjars</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Deprecated/ignored; ajc does this.) If true, copy all
non-.class files from input jar(s) to the output jar or destination
directory after the compile (or incremental compile) completes. In
forked mode, this copies only after the process completes, not after
incremental compiles.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sourceRootCopyFilter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When set, copy all files from the sourceroot
directories to the output jar or destination directory except those
specified in the filter pattern. The pattern should be compatible with
an Ant fileset excludes filter; when using this, most developers pass
<code><strong>/CVS/<strong>,</strong>/</strong>.java</code> to exclude any CVS directories or source files. See
<code>inpathDirCopyFilter</code>. Requires <code>destDir</code> or <code>outJar</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">inpathDirCopyFilter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When set, copy all files from the inpath
directories to the output jar or destination directory except those
specified in the filter pattern. The pattern should be compatible with
an Ant fileset excludes filter; when using this, most developers pass
<code><strong>/CVS/<strong>,</strong>/</strong>.java,<strong>/<strong>.class</code> to exclude any CVS directories, source
files, or unwoven .class files. (If <code></strong>/</strong>.class</code> is not specified, it
will be prepended to the filter.) See <code>sourceRootCopyFilter</code>. (Note that
ajc itself copies all resources from input jar/zip files on the inpath.)
Requires <code>destDir</code> or <code>outJar</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>AjcTask (iajc) options for specifying compiler behavior</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fork</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run process in another VM. This gets the forking classpath either
explicitly from a <code>forkclasspath</code> entry or by searching the task or
system/Ant classpath for the first readable file with a name of the form
<code>aspectj{-}tools{.*}.jar</code>. When forking you can specify the amount of
memory used with <code>maxmem</code>. Fork cannot be used in incremental mode,
unless using a tag file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">forkclasspath, forkclasspathRef (<a href="#antTasks-iajc-paths">Path</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the classpath to use for the compiler when forking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxmem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum memory to use for the new VM when fork is true.
Values should have the same form as accepted by the VM, e.g., "128m".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">incremental</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incremental mode: Build once, then recompile only required
source files when user provides input. Requires that source files be
specified only using <code>sourceroots</code>. Incompatible with forking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tagfile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">incremental mode: Build once, then recompile only required
source files when the tag file is updated, finally exiting when tag file
is deleted. Requires that source files be specified only using
<code>sourceroots</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set experimental option(s), using comma-separated list of accepted
options Options should not contain the leading X. Some commonly-used
experimental options have their own entries. The other permitted ones
(currently) are serializableAspects, incrementalFile, lazyTjp,
reweavable, notReweavable, noInline, terminateAfterCompilation,
ajruntimelevel:1.2, and ajruntimelevel:1.5. Of these, some were
deprecated in AspectJ 5 (reweavable, terminateAfterCompilation, etc.).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XterminateAfterCompilation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Terminates before the weaving process,
dumping out unfinished class files.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>AjcTask (iajc) options for specifying compiler side-effects and
messages</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">emacssym</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, emit <code>.ajesym</code> symbol files for Emacs support.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">crossref</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, emit <code>.ajsym</code> file into the output directory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">verbose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, log compiler verbose messages as Project.INFO during
the compile.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logCommand</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, log compiler command elements as Project.INFO
(rather than the usual Project.VERBOSE level).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Xlistfileargs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, emit list of file arguments during the compile
(but behaves now like verbose).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, do not compile - just print AspectJ version.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">help</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, just print help for the command-line compiler.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Xlintwarnings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as <code>xlint:warning</code>: if true, set default level of
all language usage messages to warning.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Xlint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify default level of all language usage messages to one of
[<code>error warning ignore</code>].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XlintFile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify property file containing <code>name:level</code> associations
setting level for language messages emitted during compilation. Any
levels set override the default associations in
<code>org/aspectj/weaver/XLintDefault.properties</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">failonerror</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, throw BuildException to halt build if there are
any compiler errors. If false, continue notwithstanding compile errors.
Defaults to <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">messageHolderClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify a class to use as the message holder for
the compile process. The entry must be a fully-qualified name of a class
resolveable from the task classpath complying with the
<code>org.aspectj.bridge.IMessageHolder</code> interface and having a public
no-argument constructor.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">showWeaveInfo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, emit weaver messages. Defaults to <code>false</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>AjcTask (iajc) options for specifying Eclipse compiler options</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nowarn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, same as <code>warn:none</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deprecation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, same as <code>warn:deprecation</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">warn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more comma-separated warning specifications from
[<code>constructorName packageDefaultMethod deprecation,
                  maskedCatchBlocks unusedLocals unusedArguments,
                 unusedImports syntheticAccess assertIdentifier</code>].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">debug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, same as <code>debug:lines,vars,source</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">debugLevel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more comma-separated debug specifications from
[<code>lines vars source</code>].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PreserveAllLocals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, code gen preserves all local variables (for
debug purposes).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">noimporterror</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, emit no errors for unresolved imports.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">referenceinfo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, compute reference info.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File to log compiler messages to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">encoding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default source encoding format (per-file encoding not
supported in Ant tasks).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proceedOnError</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, keep compiling after errors encountered,
dumping class files with problem methods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">progress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, emit progress (requires log).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, display speed information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">target</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify target class file format as one of [<code>1.1 1.2</code>].
Defaults to 1.1 class file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">source</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set source compliance level to one of [<code>1.3 1.4 1.5</code>] (default
is 1.4). 1.3 implies -source 1.3 and -target 1.1. 1.4 implies -source
1.4 and -target 1.2. 1.5 implies -source 1.5 and -target 1.5.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">source</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set source assertion mode to one of [<code>1.3 1.4</code>]. Default
depends on compliance mode.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="antTasks-nested-includes">AjcTask matching parameters specified as nested elements</h4>
<div class="paragraph">
<p>This task forms an implicit FileSet and supports all attributes of
<code>fileset</code> (dir becomes srcdir) as well as the nested <code>include</code>,
<code>exclude</code>, and <code>patternset</code> elements. These can be used to specify
source files. However, it is better to use <code>sourceroots</code> to specify
source directories unless using filters to exclude some files from
compilation.</p>
</div>
</div>
<div class="sect3">
<h4 id="antTasks-iajc-paths">AjcTask Path-like Structures</h4>
<div class="paragraph">
<p>Some parameters are path-like structures containing one or more
elements; these are <code>sourceroots</code>, <code>argfiles</code>, <code>injars</code>, <code>inpath</code>,
<code>classpath</code>, <code>bootclasspath</code>, <code>forkclasspath</code>, and <code>aspectpath</code>. In all
cases, these may be specified as nested elements, something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;iajc</span> <span class="error">{</span><span class="attribute-name">attributes..</span><span class="error">}</span> <span class="tag">/&gt;</span>
    <span class="error">&lt;</span>{name}<span class="error">&gt;</span>
        <span class="tag">&lt;pathelement</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{first-location}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;pathelement</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{second-location}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        ...
    <span class="error">&lt;</span>{name}<span class="error">&gt;</span>
    ...
<span class="tag">&lt;/iajc&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As with other Path-like structures, they may be defined elsewhere and
specified using the refid attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;path</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aspect.path</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;pathelement</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${home}/lib/persist.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;pathelement</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${home}/lib/trace.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/path&gt;</span>
...
<span class="tag">&lt;iajc</span> <span class="error">{</span><span class="attribute-name">attributes..</span><span class="error">}</span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;aspectpath</span> <span class="attribute-name">refid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aspect.path</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    ...
<span class="tag">&lt;/iajc&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The task also supports an attribute <code>{name}ref</code> for each such parameter.
E.g., for <code>aspectpath</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;iajc</span> <span class="error">{</span><span class="attribute-name">attributes..</span><span class="error">}</span> <span class="attribute-name">aspectpathref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aspect.path</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="antTasks-iajc-sample">Sample of iajc task</h4>
<div class="paragraph">
<p>A minimal build script defines the task and runs it, specifying the
sources:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;project</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simple-example</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">compile</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
  <span class="tag">&lt;taskdef</span>
      <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org/aspectj/tools/ant/taskdefs/aspectjTaskdefs.properties</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;classpath&gt;</span>
      <span class="tag">&lt;pathelement</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${home.dir}/tools/aspectj/lib/aspectjtools.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/classpath&gt;</span>
  <span class="tag">&lt;/taskdef&gt;</span>

  <span class="tag">&lt;target</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">compile</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
    <span class="tag">&lt;iajc</span> <span class="attribute-name">sourceroots</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${home.dir}/ec/project/src</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">classpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${home.dir}/tools/aspectj/lib/aspectjrt.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/target&gt;</span>
<span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Below is script with most everything in it. The compile process&#8230;&#8203;</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Runs in incremental mode, recompiling when the user hits return;</p>
</li>
<li>
<p>Reads all the source files from two directories;</p>
</li>
<li>
<p>Reads binary .class files from input jar and directory;</p>
</li>
<li>
<p>Uses a binary aspect library for persistence;</p>
</li>
<li>
<p>Outputs to an application jar; and</p>
</li>
<li>
<p>Copies resources from the source directories and binary input jar and
directories to the application jar.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When this target is built, the compiler will build once and then wait
for input from the user. Messages are printed as usual. When the user
has quit, then this runs the application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;target</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">build-test</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
  <span class="tag">&lt;iajc</span> <span class="attribute-name">outjar</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${home.dir}/output/application.jar</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">sourceRootCopyFilter</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">**/CVS/*,**/*.java</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">inpathDirCopyFilter</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">**/CVS/*,**/*.java,**/*.class</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">incremental</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
    <span class="tag">&lt;sourceroots&gt;</span>
      <span class="tag">&lt;pathelement</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${home.dir}/ec/project/src</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;pathelement</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${home.dir}/ec/project/testsrc</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/sourceroots&gt;</span>
    <span class="tag">&lt;inpath&gt;</span>
      <span class="tag">&lt;pathelement</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${home.dir}/build/module.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;pathelement</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${home.dir}/build/binary-input</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/inpath&gt;</span>
    <span class="tag">&lt;aspectpath&gt;</span>
      <span class="tag">&lt;pathelement</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${home.dir}/ec/int/persist.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/aspectpath&gt;</span>
    <span class="tag">&lt;classpath&gt;</span>
      <span class="tag">&lt;pathelement</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${home.dir}/tools/aspectj/lib/aspectjrt.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/classpath&gt;</span>
  <span class="tag">&lt;/iajc&gt;</span>

  <span class="tag">&lt;java</span> <span class="attribute-name">classname</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.smart.app.Main</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;classpath&gt;</span>
      <span class="tag">&lt;pathelement</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${home.dir}/tools/aspectj/lib/aspectjrt.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;pathelement</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${home.dir}/ec/int/persist.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;pathelement</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${home.dir}/output/application.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/classpath&gt;</span>
  <span class="tag">&lt;/java&gt;</span>
<span class="tag">&lt;/target&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For an example of a build script, see ../examples/build.xml.</p>
</div>
</div>
<div class="sect3">
<h4 id="antTasks-iajc-uptodate">Avoiding clean compiles</h4>
<div class="paragraph">
<p>Unlike javac, the ajc compiler always processes all input because new
aspects can apply to updated classes and vice-versa. However, in the
case where no files have been updated, there is no reason to recompile
sources. One way to implement that is with an explicit dependency check
using the uptodate task:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;target</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">check.aspects.jar</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;uptodate</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">build.unnecessary</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">targetfile</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${aspects.module-jar}</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
     <span class="tag">&lt;srcfiles</span> <span class="attribute-name">dir</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${src1}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">includes</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">**/*.aj</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
     <span class="tag">&lt;srcfiles</span> <span class="attribute-name">dir</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${src2}/</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">includes</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">**/*.aj</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/uptodate&gt;</span>
<span class="tag">&lt;/target&gt;</span>

<span class="tag">&lt;target</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">compile.aspects</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">depends</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prepare,check.aspects.jar</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">unless</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">build.unnecessary</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;iajc</span> <span class="attribute-name">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When using this technique, be careful to verify that binary input jars
are themselves up-to-date after they would have been modified by any
build commands.</p>
</div>
</div>
<div class="sect3">
<h4 id="_programmatically_handling_compiler_messages">Programmatically handling compiler messages</h4>
<div class="paragraph">
<p>Users may specify a message holder to which the compiler will pass all
messages as they are generated. This will override all of the normal
message printing, but does not prevent the task from failing if
exceptions were thrown or if failonerror is true and the compiler
detected errors in the sources.</p>
</div>
<div class="paragraph">
<p>Handling messages programmatically could be useful when using the
compiler to verify code. If aspects consist of declare [error|warning],
then the compiler can act to detect invariants in the code being
processed. For code to compare expected and actual messages, see the
AspectJ testing module (which is not included in the binary
distribution).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="antTasks-adapter">Ajc11CompilerAdapter (javac)</h3>
<div class="paragraph">
<p>This CompilerAdapter can be used in javac task calls by setting the
<code>build.compiler</code> property. This enables users to to easily switch
between the Javac and AspectJ compilers. However, because there are
differences in source file handling between the Javac task and the ajc
compiler, not all Javac task invocations can be turned over to iajc.
However, ajc can compile anything that Javac can, so it should be
possible for any given compile job to restate the Javac task in a way
that can be handled by iajc/ajc.</p>
</div>
<div class="sect3">
<h4 id="antTasks-adapter-sample">Sample of compiler adapter</h4>
<div class="paragraph">
<p>To build using the adapter, put the <code>aspectjtools.jar</code> on the system/ant
classpath (e.g., in <code>${ANT_HOME}/lib</code>) and define the <code>build.compiler</code>
property as the fully-qualified name of the class,
<code>org.aspectj.tools.ant.taskdefs.Ajc11CompilerAdapter</code>.</p>
</div>
<div class="paragraph">
<p>The AspectJ compiler should run for any compile using the Javac task
(for options, see the Ant documentation for the Javac task). For
example, the call below passes all out-of-date source files in the
<code>src/org/aspectj</code> subdirectories to the <code>ajc</code> command along with the
destination directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">-- command:

    cp aspectj1.1/lib/aspectjtools.jar ant/lib
    ant/bin/ant -Dbuild.compiler=org.aspectj.tools.ant.taskdefs.Ajc11CompilerAdapter ...

-- task invocation in the build script:

  &lt;javac srcdir=&quot;src&quot; includes=&quot;org/aspectj/**/*.java&quot; destdir=&quot;dest&quot; /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To pass ajc-specific arguments, use a compilerarg entry.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">-- command

  Ant -Dbuild.compiler=org.aspectj.tools.ant.taskdefs.Ajc11CompilerAdapter

-- build script

  &lt;property name=&quot;ajc&quot;
              value=&quot;org.aspectj.tools.ant.taskdefs.Ajc11CompilerAdapter&quot;/&gt;

  &lt;javac srcdir=&quot;src&quot; includes=&quot;org/aspectj/**/*.java&quot; destdir=&quot;dest&quot; &gt;
    &lt;compilerarg compiler=&quot;${ajc}&quot; line=&quot;-argfile src/args.lst&quot;/&gt;
  &lt;javac/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Javac task does special handling of source files that can interfere
with ajc. It removes any files that are not out-of-date with respect to
the corresponding .class files. But ajc requires all source files, since
an aspect may affect a source file that is not out of date. (For a
solution to this, see the <code>build.compiler.clean</code> property described
below.) Conversely, developers sometimes specify a source directory to
javac, and let it search for files for types it cannot find. AspectJ
will not do this kind of searching under the source directory (since the
programmer needs to control which sources are affected). (Don&#8217;t confuse
the source directory used by Javac with the source root used by ajc; if
you specify a source root to ajc, it will compile any source file under
that source root (without exception or filtering).) To replace source
dir searching in Javac, use an Ant filter to specify the source files.</p>
</div>
</div>
<div class="sect3">
<h4 id="antTasks-adapter-options">Compiler adapter compilerarg options</h4>
<div class="paragraph">
<p>The adapter supports any ajc command-line option passed using
compilerarg, as well as the following options available only in AjcTask.
Find more details on the following options in
<a href="#antTasks-iajc">AjcTask (iajc)</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-Xmaxmem</code>: set maximum memory for forking (also settable in javac).</p>
</li>
<li>
<p><code>-Xlistfileargs</code>: list file arguments (also settable in javac).</p>
</li>
<li>
<p><code>-Xfailonerror</code>: throw BuildException on compiler error (also settable
in javac).</p>
</li>
<li>
<p><code>-Xmessageholderclass</code>: specify fully-qualified name of class to use
as the message holder.</p>
</li>
<li>
<p><code>-Xcopyinjars</code>: copy resources from any input jars to output (default
behavior since 1.1.1)</p>
</li>
<li>
<p><code>-Xsourcerootcopyfilter {filter}</code>: copy resources from source
directories to output (minus files specified in filter)</p>
</li>
<li>
<p><code>-Xtagfile {file}</code>: use file to control incremental compilation</p>
</li>
<li>
<p><code>-Xsrcdir {dir}</code>: add to list of ajc source roots (all source files
will be included).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Special considerations when using Javac and compilerarg:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The names above may differ slightly from what you might expect from
AjcTask; use these forms when specifying compilerarg.</p>
</li>
<li>
<p>By default the adapter will mimic the Javac task&#8217;s copying of resource
files by specifying <code>"<strong>/CVS/<strong>,</strong>/</strong>.java,<strong>/<strong>.aj"</code> for the sourceroot
copy filter. To change this behavior, supply your own value (e.g.,
<code>"</strong>/</strong>"</code> to copy nothing).</p>
</li>
<li>
<p>Warning - define the system property <code>build.compiler.clean</code> to compile
all files, when available. Javac prunes the source file list of
"up-to-date" source files based on the timestamps of corresponding
.class files, and will not compile if no sources are out of date. This
is wrong for ajc which requires all the files for each compile and which
may refer indirectly to sources using argument files.</p>
<div class="paragraph">
<p>To work around this, set the global property <code>build.compiler.clean</code>.
This tells the compiler adapter to delete all .class files in the
destination directory and re-execute the javac task so javac can
recalculate the list of source files. e.g.,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">Ant -Dbuild.compiler=org.aspectj.tools.ant.taskdefs.Ajc11CompilerAdapter
    -Dbuild.compiler.clean=anything ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Caveats to consider when using this global <code>build.compiler.clean</code>
property:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If javac believes there are no out-of-date source files, then the
adapter is never called and cannot clean up, and the "compile" will
appear to complete successfully though it did nothing.</p>
</li>
<li>
<p>Cleaning will makes stepwise build processes fail if they depend on
the results of the prior compilation being in the same directory, since
cleaning deletes all .class files.</p>
</li>
<li>
<p>This clean process only permits one compile process at a time for each
destination directory because it tracks recursion by writing a tag file
to the destination directory.</p>
</li>
<li>
<p>When running incrementally, the clean happens only before the initial
compile.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="antTasks-ajc">Ajc10 (ajc)</h3>
<div class="paragraph">
<p>This task handles the same arguments as those used by the AspectJ 1.0
task. This should permit those with existing build scripts using the Ajc
Ant task to continue using the same scripts when compiling with 1.1.
This will list any use of options no longer supported in 1.1 (e.g.,
<code>lenient, strict, workingdir, preprocess, usejavac</code>,&#8230;&#8203;), and does not
provide access to the new features of AspectJ 1.1. (Developers using
AspectJ 1.1 only should upgrade their scripts to use AjcTask instead.
This will not work for AspectJ 1.2 or later.)</p>
</div>
<div class="sect3">
<h4 id="antTasks-ajc-options">Ajc10 (ajc) Options</h4>
<div class="paragraph">
<p>Most attributes and nested elements are optional. The compiler requires
that the same version of <code>aspectjrt.jar</code> be specified on the classpath,
and that some sources be be specified (using one or more of <code>argfiles</code>
and <code>srcdir</code> (with patterns)).</p>
</div>
<div class="paragraph">
<p>Boolean parameters default to <code>false</code> unless otherwise stated.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. AjcTask (ajc) options for specifying sources</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">srcdir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The base directory of the java files. See</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">destdir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The target directory for the output .class files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma-separated list of patterns of files that must be
included. No files are included when omitted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includesfile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path to a file containing include patterns.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma-separated list of patterns of files that must be
excluded. No files (except default excludes) are excluded when omitted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludesfile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path to a file containing exclude patterns.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">defaultexcludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, then default excludes are used. Default
excludes are used when omitted (i.e., defaults to <code>true</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">classpath, classpathref</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The classpath to use, optionally given as a
reference to a classpath Path element defined elsewhere.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootclasspath, bootclasspathref</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The bootclasspath to use, optionally
given as a reference to a bootclasspath Path element defined elsewhere.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">extdirs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Paths to directories containting installed extensions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">debug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, emit debug info in the .class files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deprecation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, emit messages about use of deprecated API.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">verbose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emit compiler status messages during the compile.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emit version information and quit.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">failonerror</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, throw BuildException to halt build if there are
any compiler errors. If false, continue notwithstanding compile errors.
Defaults to <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">source</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value of -source option - ignored unless <code>1.4</code>.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Parameters ignored by the old ajc taskdef, but now supported or buggy</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Supported?</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">encoding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default encoding of source files.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">optimize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether source should be compiled with optimization.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">target</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generate class files for specific VM version, one of
[<code>1.1 1.2</code>].</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">depend</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables dependency-tracking.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeAntRuntime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to include the Ant run-time libraries.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeJavaRuntime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to include the run-time libraries from the
executing VM.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multi-threaded compilation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following table shows that many of the unique parameters in AspectJ
1.0 are no longer supported.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Parameters unique to ajc</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deprecated X options include reweavable (on by default)
reweavable:compress (compressed by default)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">emacssym</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generate symbols for Emacs IDE support.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">argfiles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma-delimited list of argfiles that contain a
line-delimited list of source file paths (absolute or relative to the
argfile).</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_argfiles_argument_list_files">argfiles - argument list files</h5>
<div class="paragraph">
<p>An argument file is a file (usually <code>{file}.lst</code>) containing a list of
source file paths (absolute or relative to the argfile). You can use it
to specify all source files to be compiled, which ajc requires to avoid
searching every possible source file in the source path when building
aspects. If you specify an argfile to the ajc task, it will not include
all files in any specified source directory (which is the default
behavior for the Javac task when no includes are specified). Conversely,
if you specify excludes, they will be removed from the list of files
compiled even if they were specified in an argument file.</p>
</div>
<div class="paragraph">
<p>The compiler also accepts arguments that are not source files, but the
IDE support for such files varies, and Javac does not support them. Be
sure to include exactly one argument on each line.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="antTasks-ajc-nested">Ajc10 parameters specified as nested elements</h4>
<div class="paragraph">
<p>This task forms an implicit FileSet and supports all attributes of
<code>fileset</code> (dir becomes srcdir) as well as the nested <code>include</code>,
<code>exclude</code>, and <code>patternset</code> elements. These can be used to specify
source files.</p>
</div>
<div class="paragraph">
<p><code>ajc</code>'s <code>srcdir</code>, <code>classpath</code>, <code>bootclasspath</code>, <code>extdirs</code>, and <code>jvmarg</code>
attributes are path-like structures and can also be set via nested
<code>src</code>, <code>classpath</code>, <code>bootclasspath</code>, <code>extdirs</code>, and <code>jvmargs</code>
elements, respectively.</p>
</div>
</div>
<div class="sect3">
<h4 id="antTasks-ajc-sample">Sample of ajc task</h4>
<div class="paragraph">
<p>Following is a declaration for the ajc task and a sample invocation that
uses the ajc compiler to compile the files listed in <code>default.lst</code> into
the dest dir:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;project</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">compile</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
  <span class="tag">&lt;taskdef</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ajc</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">classname</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.aspectj.tools.ant.taskdefs.Ajc10</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
    <span class="comment">&lt;!-- declare classes needed to run the tasks and tools --&gt;</span>
    <span class="tag">&lt;classpath&gt;</span>
      <span class="tag">&lt;pathelement</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${home.dir}/tools/aspectj/lib/aspectjtools.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/classpath&gt;</span>
  <span class="tag">&lt;/taskdef&gt;</span>

  <span class="tag">&lt;target</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">compile</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
    <span class="tag">&lt;mkdir</span> <span class="attribute-name">dir</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dest</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;ajc</span> <span class="attribute-name">destdir</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dest</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">argfiles</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.lst</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
      <span class="comment">&lt;!-- declare classes needed to compile the target files --&gt;</span>
      <span class="tag">&lt;classpath&gt;</span>
        <span class="tag">&lt;pathelement</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${home.dir}/tools/aspectj/lib/aspectjrt.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/classpath&gt;</span>
    <span class="tag">&lt;/ajc&gt;</span>
  <span class="tag">&lt;/target&gt;</span>
<span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This build script snippet</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ajc</span> <span class="attribute-name">srcdir</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${src}</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">destdir</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${build}</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">argfiles</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">demo.lst</span><span class="delimiter">&quot;</span></span>
<span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>compiles all .java files specified in the demo.lst and stores the .class
files in the ${build} directory. Unlike the Javac task, the includes
attribute is empty by default, so only those files specified in demo.lst
are included.</p>
</div>
<div class="paragraph">
<p>This next example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ajc</span> <span class="attribute-name">srcdir</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${src}</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">destdir</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${build}</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">includes</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">spacewar/*,coordination/*</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">excludes</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">spacewar/Debug.java</span><span class="delimiter">&quot;</span></span>
<span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>compiles .java files under the <code>${src}</code> directory in the spacewar and
coordination packages, and stores the .class files in the <code>${build}</code>
directory. All source files under spacewar/ and coordination/ are used,
except Debug.java.</p>
</div>
<div class="paragraph">
<p>See ../examples/build.xml for an example build script.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="antTasks-problems">Isolating problems running the Ant tasks</h3>
<div class="paragraph">
<p>If you have problems with the tasks not solved by the documentation,
please try to see if you have the same problems when running ajc
directly on the command line.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the problem occurs on the command line also, then the problem is
not in the task. (It may be in the tools; please send bug reports.)</p>
</li>
<li>
<p>If the problem does not occur on the command line, then it may lie in
the parameters you are supplying in Ant or in the task&#8217;s handling of
them.</p>
</li>
<li>
<p>If the build script looks correct and the problem only occurs when
building from Ant, then please send a report (including your build file,
if possible).</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="antTasks-knownProblems">Known issues with the Ant tasks</h4>
<div class="paragraph">
<p>For the most up-to-date information on known problems, see the
<a href="https://bugs.eclipse.org/bugs">bug database</a> for unresolved
<a href="https://bugs.eclipse.org/bugs/buglist.cgi?&amp;product=AspectJ&amp;component=Compiler&amp;bug_status=NEW&amp;bug_status=ASSIGNED&amp;bug_status=REOPENED">compiler
bugs</a> or
<a href="https://bugs.eclipse.org/bugs/buglist.cgi?&amp;product=AspectJ&amp;component=Ant&amp;bug_status=NEW&amp;bug_status=ASSIGNED&amp;bug_status=REOPENED">taskdef
bugs</a> .</p>
</div>
<div class="paragraph">
<p>When running Ant build scripts under Eclipse 2.x variants, you will get
a VerifyError because the Eclipse Ant support fails to isolate the Ant
runtime properly. To run in this context, set up iajc to fork (and use
forkclasspath). Eclipse 3.0 will fork Ant processes to avoid problems
like this.</p>
</div>
<div class="paragraph">
<p>Memory and forking: Users email most often about the ajc task running
out of memory. This is not a problem with the task; some compiles take a
lot of memory, often more than similar compiles using javac.</p>
</div>
<div class="paragraph">
<p>Forking is now supported in both the
<a href="#antTasks-adapter">Ajc11CompilerAdapter (javac)</a> and
<a href="#antTasks-iajc">AjcTask (iajc)</a>, and you can set the maximum memory
available. You can also not fork and increase the memory available to
Ant (see the Ant documentation, searching for ANT_OPTS, the variable
they use in their scripts to pass VM options, e.g., ANT_OPTS=-Xmx128m).</p>
</div>
</div>
<div class="sect3">
<h4 id="antTasks-feedback">Ant task questions and bugs</h4>
<div class="paragraph">
<p>For questions, you can send email to <a href="mailto:aspectj-users@dev.eclipse.org">aspectj-users@dev.eclipse.org</a>. (Do
join the list to participate!) We also welcome any bug reports, patches,
and features; you can submit them to the bug database at
<a href="https://bugs.eclipse.org/bugs" class="bare">https://bugs.eclipse.org/bugs</a> using the AspectJ product and Ant
component.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ltw">Load-Time Weaving</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ltw-introduction">Introduction</h3>
<div class="paragraph">
<p>The AspectJ weaver takes class files as input and produces class files
as output. The weaving process itself can take place at one of three
different times: compile-time, post-compile time, and load-time. The
class files produced by the weaving process (and hence the run-time
behaviour of an application) are the same regardless of the approach
chosen.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Compile-time weaving is the simplest approach. When you have the
source code for an application, ajc will compile from source and produce
woven class files as output. The invocation of the weaver is integral to
the ajc compilation process. The aspects themselves may be in source or
binary form. If the aspects are required for the affected classes to
compile, then you must weave at compile-time. Aspects are required,
e.g., when they add members to a class and other classes being compiled
reference the added members.</p>
</li>
<li>
<p>Post-compile weaving (also sometimes called binary weaving) is used to
weave existing class files and JAR files. As with compile-time weaving,
the aspects used for weaving may be in source or binary form, and may
themselves be woven by aspects.</p>
</li>
<li>
<p>Load-time weaving (LTW) is simply binary weaving defered until the
point that a class loader loads a class file and defines the class to
the JVM. To support this, one or more "weaving class loaders", either
provided explicitly by the run-time environment or enabled through a
"weaving agent" are required.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You may also hear the term "run-time weaving". We define this as the
weaving of classes that have already been defined to the JVM (without
reloading those classes). AspectJ 5 does not provide explicit support
for run-time weaving although simple coding patterns can support
dynamically enabling and disabling advice in aspects.</p>
</div>
<div class="sect3">
<h4 id="_weaving_class_files_more_than_once">Weaving class files more than once</h4>
<div class="paragraph">
<p>As of AspectJ 5 aspects (code style or annotation style) and woven
classes are reweavable by default. If you are developing AspectJ
applications that are to be used in a load-time weaving environment with
an older version of the compiler you need to specify the <code>-Xreweavable</code>
compiler option when building them. This causes AspectJ to save
additional state in the class files that is used to support subsequent
reweaving.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ltw-rules">Load-time Weaving Requirements</h3>
<div class="paragraph">
<p>All load-time weaving is done in the context of a class loader, and
hence the set of aspects used for weaving and the types that can be
woven are affected by the class loader delegation model. This ensures
that LTW complies with the Java 2 security model. The following rules
govern the interaction of load-time weaving with class loading:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>All aspects to be used for weaving must be defined to the weaver
before any types to be woven are loaded. This avoids types being
"missed" by aspects added later, with the result that invariants across
types fail.</p>
</li>
<li>
<p>All aspects visible to the weaver are usable. A visible aspect is one
defined by the weaving class loader or one of its parent class loaders.
All concrete visible aspects are woven and all abstract visible aspects
may be extended.</p>
</li>
<li>
<p>A class loader may only weave classes that it defines. It may not
weave classes loaded by a delegate or parent class loader.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="ltw-configuration">Configuration</h3>
<div class="paragraph">
<p>New in AspectJ 5 are a number of mechanisms to make load-time weaving
easy to use. The load-time weaving mechanism is chosen through JVM
startup options. Configuration files determine the set of aspects to be
used for weaving and which types will be woven. Additional diagnostic
options allow the user to debug the configuration and weaving process.</p>
</div>
<div class="sect3">
<h4 id="_enabling_load_time_weaving">Enabling Load-time Weaving</h4>
<div class="paragraph">
<p>AspectJ 5 supports several ways of enabling load-time weaving for an
application: agents, a command-line launch script, and a set of
interfaces for integration of AspectJ load-time weaving in custom
environments.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Agents</dt>
<dd>
<p>AspectJ 5 ships with a load-time weaving agent that enables load-time
weaving. This agent and its configuration is execution environment
dependent. Configuration for the supported environments is discussed
later in this chapter.</p>
<div class="paragraph">
<p>Using Java 5 JVMTI you can specify the
<code>-javaagent:pathto/aspectjweaver.jar</code> option to the JVM.</p>
</div>
<div class="paragraph">
<p>Since AspectJ 1.9.7, the obsolete Oracle/BEA JRockit agent is no
longer part of AspectJ. JRockit JDK never supported Java versions
higher than 1.6. Several JRockit JVM features are now part of HotSpot
and tools like Mission Control available for OpenJDK and Oracle JDK.</p>
</div>
</dd>
<dt class="hdlist1">Command-line wrapper scripts <code>aj</code></dt>
<dd>
<p>The <code>aj</code> command runs Java programs in Java 1.4 or later by setting up
<code>WeavingURLClassLoader</code> as the system class loader. For more
information, see <a href="#aj"><code>aj</code>, the AspectJ load-time weaving launcher</a>.</p>
<div class="paragraph">
<p>The <code>aj5</code> command runs Java programs in Java 5 by using the
<code>-javaagent:pathto/aspectjweaver.jar</code> option described above. For more
information, see <a href="#aj"><code>aj</code>, the AspectJ load-time weaving launcher</a>.</p>
</div>
</dd>
<dt class="hdlist1">Custom class loader</dt>
<dd>
<p>A public interface is provided to allow a user written class loader to
instantiate a weaver and weave classes after loading and before
defining them in the JVM. This enables load-time weaving to be
supported in environments where no weaving agent is available. It also
allows the user to explicitly restrict by class loader which classes
can be woven. For more information, see <a href="#aj"><code>aj</code>, the AspectJ load-time weaving launcher</a> and the API
documentation and source for <code>WeavingURLClassLoader</code> and
<code>WeavingAdapter</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="configuring-load-time-weaving-with-aopxml-files">Configuring Load-time Weaving with aop.xml files</h4>
<div class="paragraph">
<p>The weaver is configured using one or more <code>META-INF/aop.xml</code> files
located on the class loader search path. Each file may declare a list of
aspects to be used for weaving, type patterns describing which types
should woven, and a set of options to be passed to the weaver. In
addition AspectJ 5 supports the definition of concrete aspects in XML.
Aspects defined in this way must extend an abstract aspect visible to
the weaver. The abstract aspect may define abstract pointcuts (but not
abstract methods). The following example shows a simple aop.xml file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aspectj&gt;</span>

  <span class="tag">&lt;aspects&gt;</span>
    <span class="comment">&lt;!-- declare two existing aspects to the weaver --&gt;</span>
    <span class="tag">&lt;aspect</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.MyAspect</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;aspect</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.MyAspect.Inner</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- define a concrete aspect inline --&gt;</span>
    <span class="tag">&lt;concrete-aspect</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.tracing.MyTracing</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">extends</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tracing.AbstractTracing</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">precedence</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.first, *</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;pointcut</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tracingScope</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">within(org.maw.*)</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/concrete-aspect&gt;</span>

    <span class="comment">&lt;!-- Of the set of aspects declared to the weaver
         use aspects matching the type pattern &quot;com..*&quot; for weaving. --&gt;</span>
    <span class="tag">&lt;include</span> <span class="attribute-name">within</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com..*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- Of the set of aspects declared to the weaver
         do not use any aspects with the @CoolAspect annotation for weaving --&gt;</span>
    <span class="tag">&lt;exclude</span> <span class="attribute-name">within</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@CoolAspect *</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

  <span class="tag">&lt;/aspects&gt;</span>

  <span class="tag">&lt;weaver</span> <span class="attribute-name">options</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">-verbose</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Weave types that are within the javax.* or org.aspectj.*
         packages. Also weave all types in the foo package that do
         not have the @NoWeave annotation. --&gt;</span>
    <span class="tag">&lt;include</span> <span class="attribute-name">within</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;include</span> <span class="attribute-name">within</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.aspectj.*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;include</span> <span class="attribute-name">within</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">(!@NoWeave foo.*) AND foo.*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- Do not weave types within the &quot;bar&quot; pakage --&gt;</span>
    <span class="tag">&lt;exclude</span> <span class="attribute-name">within</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bar.*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- Dump all types within the &quot;com.foo.bar&quot; package
         to the &quot;./_ajdump&quot; folder on disk (for diagnostic purposes) --&gt;</span>
    <span class="tag">&lt;dump</span> <span class="attribute-name">within</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.bar.*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="comment">&lt;!-- Dump all types within the &quot;com.foo.bar&quot; package and sub-packages,
         both before are after they are woven,
         which can be used for byte-code generated at runtime
    &lt;dump within=&quot;com.foo.bar..*&quot; beforeandafter=&quot;true&quot;/&gt;
  &lt;/weaver&gt;

&lt;/aspectj&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The DTD defining the format of this file is available here:
<a href="https://www.eclipse.org/aspectj/dtd/aspectj.dtd" class="bare">https://www.eclipse.org/aspectj/dtd/aspectj.dtd</a>.</p>
</div>
<div class="paragraph">
<p>An aop.xml file contains two key sections: <code>aspects</code> defines one or more
aspects to the weaver and controls which aspects are to be used in the
weaving process; <code>weaver</code> defines weaver options and which types should
be woven.</p>
</div>
<div class="paragraph">
<p>The simplest way to define an aspect to the weaver is to specify the
fully-qualified name of the aspect type in an aspect element. You can
also declare (and define to the weaver) aspects inline in the aop.xml
file. This is done using the <code>concrete-aspect</code> element. A
concrete-aspect declaration must provide a pointcut definition for every
abstract pointcut in the abstract aspect it extends. This mechanism is a
useful way of externalizing configuration for infrastructure and
auxiliary aspects where the pointcut definitions themselves can be
considered part of the configuration of the service. Refer to the next
section for more details.</p>
</div>
<div class="paragraph">
<p>The <code>aspects</code> element may optionally contain one or more <code>include</code> and
<code>exclude</code> elements (by default, all defined aspects are used for
weaving). Specifying include or exclude elements restricts the set of
defined aspects to be used for weaving to those that are matched by an
include pattern, but not by an exclude pattern. The <code>within</code> attribute
accepts a type pattern of the same form as a within pcd, except that &amp;&amp;
and || are replaced by 'AND' and 'OR'.</p>
</div>
<div class="paragraph">
<p>Note that <code>include</code> and <code>exclude</code> elements affect all aspects declared
to the weaver including those in other aop.xml files. To help avoid
unexpected behaviour a lint warning is issued if an aspect is not
declared as a result of of applying these filters. Also note <code>aspect</code>
and <code>concrete-aspect</code> elements must be used to declare aspects to the
weaver i.e. <code>include</code> and <code>exclude</code> elements cannot be used find aspects
on the class loader search path.</p>
</div>
<div class="paragraph">
<p>The <code>weaver</code> element is used to pass options to the weaver and to
specify the set of types that should be woven. If no include elements
are specified then all types visible to the weaver will be woven. In
addition the <code>dump</code> element can be used capture on disk byte-code of
woven classes for diagnostic purposes both before, in the case of those
generated at runtime, and after the weaving process.</p>
</div>
<div class="paragraph">
<p>When several configuration files are visible from a given weaving class
loader their contents are conceptually merged. The files are merged in
the order they are found on the search path (with a regular
<code>getResourceAsStream</code> lookup) according to the following rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The set of available aspects is the set of all declared and defined
aspects (<code>aspect</code> and <code>concrete-aspect</code> elements of the <code>aspects</code>
section).</p>
</li>
<li>
<p>The set of aspects used for weaving is the subset of the available
aspects that are matched by at least one include statement and are not
matched by any exclude statements. If there are no include statements
then all non-excluded aspects are included.</p>
</li>
<li>
<p>The set of types to be woven are those types matched by at least one
weaver <code>include</code> element and not matched by any weaver <code>exclude</code>
element. If there are no weaver include statements, then all non-excluded
types are included.</p>
</li>
<li>
<p>The weaver options are derived by taking the union of the options
specified in each of the weaver options attribute specifications. Where
an option takes a value e.g. <code>-warn:none</code> the most recently defined
value will be used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is not an error for the same aspect to be defined to the weaver in
more than one visible <code>META-INF/aop.xml</code> file. However, if the same
concrete aspect is defined in more than one aop.xml file then an error
will be issued. A concrete aspect defined in this way will be used to
weave types loaded by the class loader that loaded the aop.xml file in
which it was defined.</p>
</div>
<div class="paragraph">
<p>A <code>META-INF/aop.xml</code> can be generated by using either the <code>-outxml</code> or
<code>-outxmlfile</code> options of the AspectJ compiler. It will simply contain a
(possibly empty) set of aspect elements; one for each abstract or
concrete aspect defined. When used in conjuction with the <code>-outjar</code>
option a JAR is produced that can be used with the <code>aj5</code> command or a
load-time weaving environment.</p>
</div>
</div>
<div class="sect3">
<h4 id="concrete-aspect">Using Concrete Aspects</h4>
<div class="paragraph">
<p>It is possible to make an abstract aspect concrete by means of the
<code>META-INF/aop.xml</code> file. This is useful way to implement abstract
pointcuts at deployment time, and also gives control over precedence
through the <code>precedence</code> attribute of the <code>concrete-aspect</code> XML element.
Consider the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">mypack</span>;

<span class="annotation">@Aspect</span>
<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">AbstractAspect</span> {

    <span class="comment">// abstract pointcut: no expression is defined</span>
    <span class="annotation">@Pointcut</span>
    <span class="directive">abstract</span> <span class="type">void</span> scope();

    <span class="annotation">@Before</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">scope() &amp;&amp; execution(* *..doSome(..))</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> before(JoinPoint jp) {
       <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This aspect is equivalent to the following in code style:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">mypack</span>;

<span class="directive">public</span> <span class="directive">abstract</span> aspect AbstractAspect {

    <span class="comment">// abstract pointcut: no expression is defined</span>
    <span class="directive">abstract</span> pointcut scope();

    before() : scope() &amp;&amp; execution(* *..doSome(..)) {
       <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This aspect (in either style) can be made concrete using
<code>META-INF/aop.xml</code>. It defines the abstract pointcut <code>scope()</code>. When
using this mechanism the following rules apply:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The parent aspect must be abstract. It can be an @AspectJ or a regular
code style aspect.</p>
</li>
<li>
<p>Only a simple abstract pointcut can be implemented i.e. a pointcut
that doesn&#8217;t expose state (through <code>args(), this(), target(), if()</code>). In
@AspectJ syntax as illustrated in this sample, this means the method
that hosts the pointcut must be abstract, have no arguments, and return
void.</p>
</li>
<li>
<p>The concrete aspect must implement all inherited abstract pointcuts.</p>
</li>
<li>
<p>The concrete aspect may not implement methods so the abstract aspect
it extends may not contain any abstract methods.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>A limitation of the implementation of this feature in AspectJ 1.5.0 is
that aspects defined using aop.xml are not exposed to the weaver. This
means that they are not affected by advice and ITDs defined in other
aspects. Support for this capability will be considered in a future
release.</em></p>
</div>
<div class="paragraph">
<p>If more complex aspect inheritance is required use regular aspect
inheritance instead of XML. The following XML definition shows a valid
concrete sub-aspect for the abstract aspects above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aspectj&gt;</span>
    <span class="tag">&lt;aspects&gt;</span>
        <span class="tag">&lt;concrete-aspect</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mypack.__My__AbstractAspect</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">extends</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mypack.AbstractAspect</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;pointcut</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">scope</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">within(yourpackage..*)</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/concrete-aspect&gt;</span>
    <span class="tag">&lt;aspects&gt;</span>
<span class="tag">&lt;/aspectj&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is important to remember that the <code>name</code> attribute in the
<code>concrete-aspect</code> directive defines the fully qualified name that will
be given to the concrete aspect. It must a valid class name because the
aspect will be generated on the fly by the weaver. You must also ensure
that there are no name collisions. Note that the concrete aspect will be
defined at the classloader level for which the aop.xml is visible. This
implies that if you need to use the <code>aspectof</code> methods to access the
aspect instance(s) (depending on the perclause of the aspect it extends)
you have to use the helper API <code>org.aspectj.lang.Aspects.aspectOf(..)</code>
as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// exception handling omitted</span>
<span class="predefined-type">Class</span> myConcreteAspectClass = <span class="predefined-type">Class</span>.forName(<span class="string"><span class="delimiter">&quot;</span><span class="content">mypack.__My__AbstractAspect</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// here we are using a singleton aspect</span>
AbstractAspect concreteInstance = Aspects.aspectOf(myConcreteAspectClass);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="concrete-aspect-precedence">Using Concrete Aspects to define precedence</h4>
<div class="paragraph">
<p>As described in the previous section, the <code>concrete-aspect</code> element in
<code>META-INF/aop.xml</code> gives the option to declare the precedence, just as
<code>@DeclarePrecedence</code> or <code>declare precedence</code> do in aspect source code.</p>
</div>
<div class="paragraph">
<p>Sometimes it is necessary to declare precedence without extending any
abstract aspect. It is therefore possible to use the <code>concrete-aspect</code>
element without the <code>extends</code> attribute and without any <code>pointcut</code>
nested elements, just a <code>precedence</code> attribute. Consider the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;aspectj&gt;</span>
    <span class="tag">&lt;aspects&gt;</span>
        <span class="tag">&lt;concrete-aspect</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mypack.__MyDeclarePrecedence</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">precedence</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*..*Security*, Logging+, *</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/aspects&gt;</span>
<span class="tag">&lt;/aspectj&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This deployment time definitions is only declaring a precedence rule.
You have to remember that the <code>name</code> attribute must be a valid fully
qualified class name that will be then reserved for this concrete-aspect
and must not conflict with other classes you deploy.</p>
</div>
</div>
<div class="sect3">
<h4 id="weaver-options">Weaver Options</h4>
<div class="paragraph">
<p>The table below lists the AspectJ options supported by LTW. All other
options will be ignored and a warning issued.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-verbose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Issue informational messages about the weaving process.
Messages issued while the weaver is being bootstrapped are accumulated
until all options are parsed. If the messages are required to be output
immediately you can use the option <code>-Daj.weaving.verbose=true</code> on the
JVM startup command line.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Issue a messages for each class passed to the weaver
indicating whether it was woven, excluded or ignored. Also issue
messages for classes defined during the weaving process such as around
advice closures and concrete aspects defined in <code>META-INF/aop.xml</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-showWeaveInfo</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Issue informational messages whenever the weaver
touches a class file. This option may also be enabled using the System
property <code>-Dorg.aspectj.weaver.showWeaveInfo=true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-Xlintfile:pathToAResource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure lint messages as specified in
the given resource (visible from this aop.xml file' classloader)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-Xlint:default, -Xlint:ignore, &#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configure lint messages, refer to
documentation for meaningfull values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-nowarn, -warn:none</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suppress warning messages</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-Xreweavable</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Produce class files that can subsequently be rewoven</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-XnoInline</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Don&#8217;t inline around advice.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-XmessageHandlerClass:&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provide alternative output destination to
stdout/stderr for all weaver messages. The given value must be the full
qualified class name of a class that implements the
<code>org.aspectj.bridge.IMessageHandler</code> interface and is visible to the
classloader with which the weaver being configured is associated.
Exercise caution when packaging a custom message handler with an
application that is to be woven. The handler (as well as classes on
which it depends) cannot itself be woven by the aspects that are
declared to the same weaver.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ltw-specialcases">Special cases</h3>
<div class="paragraph">
<p>The following classes are not exposed to the LTW infrastructure
regardless of the <code>aop.xml</code> file(s) used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All <code>org.aspectj.*</code> classes (and subpackages) - as those are needed by
the infrastructure itself</p>
</li>
<li>
<p>All <code>java.<strong></code> and <code>javax.</strong></code> classes (and subpackages)</p>
</li>
<li>
<p>All <code>sun.reflect.*</code> classes - as those are JDK specific classes used
when reflective calls occurs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Despite these restrictions, it is perfectly possible to match call join
points for calls to these types providing the calling class is exposed
to the weaver. Subtypes of these excluded types that are exposed to the
weaver may of course be woven.</p>
</div>
<div class="paragraph">
<p>Note that dynamic proxy representations are exposed to the LTW
infrastructure and are not considered a special case.</p>
</div>
<div class="paragraph">
<p>Some lint options behave differently when used under load-time weaving.
The <code>adviceDidNotMatch</code> won&#8217;t be handled as a warn (as during compile
time) but as an info message.</p>
</div>
</div>
<div class="sect2">
<h3 id="ltw-packaging">Runtime Requirements for Load-time Weaving</h3>
<div class="paragraph">
<p>To use LTW the <code>aspectjweaver.jar</code> library must be added to the
classpath. This contains the AspectJ 5 runtime, weaver, weaving class
loader and weaving agents. It also contains the DTD for parsing XML
weaving configuration files.</p>
</div>
</div>
<div class="sect2">
<h3 id="ltw-agents">Supported Agents</h3>
<div class="sect3">
<h4 id="_jvmti">JVMTI</h4>
<div class="paragraph">
<p>When using Java 5 the JVMTI agent can be used by starting the JVM with
the following option (adapt according to the path to aspectjweaver.jar):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">-javaagent:pathto/aspectjweaver.jar</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jrockit">JRockit with Java 1.3/1.4 (use JVMTI on Java 5)</h4>
<div class="paragraph">
<p>Since AspectJ 1.9.7, the obsolete Oracle/BEA JRockit agent is no longer
part of AspectJ. JRockit JDK never supported Java versions higher than
1.6. Several JRockit JVM features are now part of HotSpot and tools like
Mission Control available for OpenJDK and Oracle JDK.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="compatibility">AspectJ version compatibility</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="versionCompatibility">Version Compatibility</h3>
<div class="paragraph">
<p>Systems, code, and build tools change over time, often not in step.
Generally, later versions of the build tools understand earlier versions
of the code, but systems should include versions of the runtime used to
build the AspectJ program.</p>
</div>
<div class="sect3">
<h4 id="javaCompatibility">Java compatibility</h4>
<div class="paragraph">
<p>AspectJ programs can run on any Java VM of the required version. The
AspectJ tools produce Java bytecode .class files that run on Java
compatible VM&#8217;s. If a Java class is changed by an aspect, the resulting
class is binary compatible (as defined in the Java Language
Specification). Further, the AspectJ compiler and weaving do all the
exception checking required of Java compilers by the Java
specifications.</p>
</div>
<div class="paragraph">
<p>Like other Java compilers, the AspectJ compiler can target particular
Java versions. Obviously, code targeted at one version cannot be run in
a VM of a lesser version. The <code>aspectjrt.jar</code> is designed to take
advantage of features available in Java 2 or Java 5, but will run in a
JDK 1.1.x environment, so you can use AspectJ to target older or
restricted versions of Java. However, there may be restricted variants
of JDK 1.1.x that do not have API&#8217;s used by the AspectJ runtime. If you
deploy to one of those, you can email <a href="mailto:aspectj-dev@eclipse.org">aspectj-dev@eclipse.org</a> or
download the runtime code to modify it for your environment.</p>
</div>
<div class="paragraph">
<p>Aside from the runtime, running the AspectJ tools themselves will
require a more recent version of Java. You might use Java 5 to run the
AspectJ compiler to produce code for Java 1.1.8.</p>
</div>
</div>
<div class="sect3">
<h4 id="runtimeCompatibility">Runtime library compatibility</h4>
<div class="paragraph">
<p>When deploying AspectJ programs, include on the classpath the classes,
aspects, and the AspectJ runtime library (<code>aspectjrt.jar</code>). Use the
version of the runtime that came with the tools used to build the
program. If the runtime is earlier than the build tools used, it&#8217;s very
likely to fail. If the runtime is later than the build tools used, it&#8217;s
possible (but not guaranteed) that it will work.</p>
</div>
<div class="paragraph">
<p>Given that, three scenarios cause problems. First, you deploy new
aspects into an an existing system that already has aspects that were
built with a different version. Second, the runtime is already deployed
in your system and cannot be changed (e.g., some application servers put
<code>aspectjrt.jar</code> on the bootclasspath). Third, you (unintentionally)
deploy two versions of the runtime, and the one loaded by a parent
loader is used).</p>
</div>
<div class="paragraph">
<p>In earlier versions of AspectJ, these problems present in obscure ways
(e.g., unable to resolve a class). In later versions, a stack trace
might even specify that the runtime version is out of sync with an
aspect. To find out if the runtime you deployed is the one actually
being used, log the defining class loader for the aspects and runtime.</p>
</div>
</div>
<div class="sect3">
<h4 id="binaryCompatibility">Aspect binary compatibility</h4>
<div class="paragraph">
<p>Generally, binary aspects can be read by later versions of the weaver if
the aspects were built by version 1.2.1 or later. (Some future weavers
might have documented limitations in how far back they go.) If a
post-1.2.1 weaver reads an aspect built by a later version, it will emit
a message. If the weaver reads in a binary aspect and writes it out
again, the result will be in the form produced by that weaver, not the
original form of the aspect (just like other weaver output).</p>
</div>
<div class="paragraph">
<p>With unreleased or development versions of the tools, there are no
guarantees for binary compatibility, unless they are stated in the
release notes. If you use aspects built with development versions of the
weaver, be careful to rebuild and redeploy with the next released
version.</p>
</div>
</div>
<div class="sect3">
<h4 id="sourceCompatibility">Aspect source compatibility</h4>
<div class="paragraph">
<p>Generally, AspectJ source files can be read by later versions of the
compiler. Language features do not change in dot releases (e.g., from
1.2.1 to 1.2.2). In some very rare cases, a language feature will no
longer be supported or may change its meaning; these cases are
documented in the release notes for that version. Some changes like this
were necessary when moving to binary weaving in the 1.1 release, but at
this time we don&#8217;t anticipate more in the future. You might also find
that the program behaves differently if you relied on behavior specific
to that compiler/weaver, but which is not specified in the
<a href="../progguide/semantics.html">Semantics appendix to the Programming
Guide</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="upgrading">Problems when upgrading to new AspectJ versions</h4>
<div class="paragraph">
<p>Let&#8217;s say your program behaves differently after being built with a new
version of the AspectJ tools. It could be a bug that was introduced by
the tools, but often it results from relying on behavior that was not
guaranteed by the compiler. For example, the order of advice across two
aspects is not guaranteed unless there is a precedence relationship
between the aspects. If the program implicitly relies on a certain order
that obtains in one compiler, it can fail when built with a different
compiler.</p>
</div>
<div class="paragraph">
<p>Another trap is deploying into the same system, when the <code>aspectjrt.jar</code>
has not been changed accordingly.</p>
</div>
<div class="paragraph">
<p>Finally, when updating to a version that has new language features,
there is a temptation to change both the code and the tools at the same
time. It&#8217;s best to validate the old code with the new tools before
updating the code to use new features. That distinguishes problems of
new engineering from those of new semantics.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</body>
</html>