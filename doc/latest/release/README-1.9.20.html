<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>AspectJ 1.9.20</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>AspectJ 1.9.20</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_aspectj_1_9_20_1">AspectJ 1.9.20.1</a></li>
<li><a href="#_aspectj_1_9_20">AspectJ 1.9.20</a>
<ul class="sectlevel2">
<li><a href="#_new_features">New features</a></li>
<li><a href="#_improvements">Improvements</a></li>
<li><a href="#_code_examples">Code examples</a></li>
<li><a href="#_other_changes_and_bug_fixes">Other changes and bug fixes</a></li>
<li><a href="#_aspectj_usage_hints">AspectJ usage hints</a>
<ul class="sectlevel3">
<li><a href="#_aspectj_compiler_build_system_requirements">AspectJ compiler build system requirements</a></li>
<li><a href="#_use_ltw_on_java_16">Use LTW on Java 16+</a></li>
<li><a href="#_compile_with_java_preview_features">Compile with Java preview features</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_aspectj_1_9_20_1">AspectJ 1.9.20.1</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>© Copyright 2023 Contributors. All rights reserved.</em></p>
</div>
<div class="paragraph">
<p><em>Release info: 1.9.20.1 available 04-Sep-2023</em></p>
</div>
<div class="paragraph">
<p>This is a bugfix release for 1.9.20, fixing two problems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/eclipse-aspectj/aspectj/issues/257">Regression bug 257</a> introduced in 1.9.20 would match negated
type patterns like <code>!void</code> or <code>!String[]</code> incorrectly.</p>
</li>
<li>
<p><a href="https://github.com/spring-projects/spring-framework/issues/27761">Spring issue 27761</a> describes a problem where
AspectJ, when used by Spring AOP, in rare cases falsely considered bridge methods for overridden generic methods for
matching, leading to falsely negative matching results. See also
<a href="https://github.com/eclipse-aspectj/aspectj/issues/256">AspectJ tracker issue 256</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The list of issues addressed for 1.9.20.1 can be found
<a href="https://github.com/eclipse-aspectj/aspectj/issues?q=is%3Aissue+is%3Aclosed++milestone%3A1.9.20.1">here</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_aspectj_1_9_20">AspectJ 1.9.20</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>© Copyright 2023 Contributors. All rights reserved.</em></p>
</div>
<div class="paragraph">
<p><em>Release info: 1.9.20 available 16-Aug-2023</em></p>
</div>
<div class="paragraph">
<p>Please note that Bugzilla for issue management is deprecated and new issues should be filed as
<a href="https://github.com/eclipse-aspectj/aspectj/issues/new">GitHub issues</a>. The list of issues addressed for 1.9.20 can be found
here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/eclipse-aspectj/aspectj/issues?q=is%3Aissue+is%3Aclosed++milestone%3A1.9.20">GitHub 1.9.20</a></p>
</li>
<li>
<p><a href="https://github.com/eclipse-aspectj/aspectj/issues?q=is%3Aissue+is%3Aclosed++milestone%3A1.9.20.1">GitHub 1.9.20.1</a></p>
</li>
<li>
<p><a href="https://bugs.eclipse.org/bugs/buglist.cgi?bug_status=RESOLVED&amp;bug_status=VERIFIED&amp;bug_status=CLOSED&amp;f0=OP&amp;f1=OP&amp;f3=CP&amp;f4=CP&amp;j1=OR&amp;list_id=16866879&amp;product=AspectJ&amp;query_format=advanced&amp;target_milestone=1.9.20">Bugzilla 1.9.20</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_new_features">New features</h3>
<div class="paragraph">
<p>AspectJ 1.9.20 supports <a href="https://openjdk.java.net/projects/jdk/20/">Java 20</a> and its final, preview and incubator
features, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Record patterns (preview)</p>
</li>
<li>
<p>Virtual threads (preview)</p>
</li>
<li>
<p>Pattern matching for <code>switch</code> (preview 3)</p>
</li>
<li>
<p>Structured concurrency (incubator)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please note, that the upstream Eclipse Java Compiler (ECJ), which the AspectJ Compiler (AJC) is a fork of, still has
some open issues concerning Java 20 preview feature support, see the list in
<a href="https://github.com/eclipse-aspectj/aspectj/issues/184#issuecomment-1272254940">this comment</a>. AJC therefore inherits the same
problems for the specific cases described in the linked issues.</p>
</div>
</div>
<div class="sect2">
<h3 id="_improvements">Improvements</h3>
<div class="ulist">
<ul>
<li>
<p>Since Java 9 and the introduction of the Java Module System, the upstream Eclipse Java Compiler (ECJ) and Eclipse Java
Development Tools (JDT) had gone through some internal changes, enabling both the compiler and the IDE to handle new
Java language features. In AspectJ, some of those internal changes have not been properly upgraded for quite a while,
but this is now fixed. However, it might <strong>require you to recompile your aspects and projects/classes using them.</strong>
Otherwise, you might get problems in Eclipse IDE or under certain circumstances even when running newly compiled
aspects in older AspectJ versions and vice versa. You are on the safe side if you simply rebuild your projects. We are
sorry for the inconvenience, but we have to follow upstream ECJ and JDT changes.</p>
</li>
<li>
<p>Along with fixing <a href="https://github.com/eclipse-aspectj/aspectj/issues/24">GitHub bug 24</a>, the syntax for array type
matching has been improved considerably. You can find some examples
<a href="https://github.com/eclipse-aspectj/aspectj/tree/master/tests/bugs1920/github_24">here</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_code_examples">Code examples</h3>
<div class="paragraph">
<p>You can find some sample code in the AspectJ test suite under the respective AspectJ version in which the features were
first supported (possibly as JVM preview features):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/eclipse-aspectj/aspectj/tree/master/tests/features198/java17">Pattern matching for switch (preview 1)</a></p>
</li>
<li>
<p><a href="https://github.com/eclipse-aspectj/aspectj/tree/master/tests/features199/java18">Pattern matching for switch (preview 2)</a></p>
</li>
<li>
<p><a href="https://github.com/eclipse-aspectj/aspectj/tree/master/tests/features1919/java19">Pattern matching for switch (preview 3),
record patterns (preview 1)</a></p>
</li>
<li>
<p><a href="https://github.com/eclipse-aspectj/aspectj/tree/master/tests/features1920/java20">Pattern matching for switch (preview 4),
record patterns (preview 2)</a></p>
</li>
<li>
<p>Please note that presently there is no specific sample code for virtual threads and structured concurrency in the
AspectJ code base, because these are just new APIs, no Java language features. You can find sample code for these
concurrency features elsewhere, e.g. in the corresponding JEPs. In AspectJ, they should just work transparently like
any other Java API.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_other_changes_and_bug_fixes">Other changes and bug fixes</h3>
<div class="ulist">
<ul>
<li>
<p>About a dozen bugs have been fixed, some of them quite old. See "list of issues addressed" further above and follow
the link to GitHub to find out if your issue is among them.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_aspectj_usage_hints">AspectJ usage hints</h3>
<div class="sect3">
<h4 id="_aspectj_compiler_build_system_requirements">AspectJ compiler build system requirements</h4>
<div class="paragraph">
<p>Since 1.9.8, the AspectJ compiler <code>ajc</code> (contained in the <code>aspectjtools</code> library) no longer works on JDKs 8 to 10. The
minimum compile-time requirement is now JDK 11 due to upstream changes in the Eclipse Java Compiler (subset of JDT
Core), which AspectJ is a fork of. You can still compile to legacy target versions as low as Java 1.3 when compiling
plain Java code or using plain Java ITD constructs which do not require the AspectJ runtime <code>aspectjrt</code>, but the
compiler itself needs JDK 11+. Just like in previous AspectJ versions, both the runtime <code>aspectjrt</code> and the load-time
weaver <code>aspectjweaver</code> still only require JRE 8+.</p>
</div>
</div>
<div class="sect3">
<h4 id="_use_ltw_on_java_16">Use LTW on Java 16+</h4>
<div class="paragraph">
<p>Please note that if you want to use load-time weaving on Java 16+, the weaving agent collides with
<a href="https://openjdk.java.net/jeps/396">JEP 396 (Strongly Encapsulate JDK Internals by Default)</a>. Therefore, you need to set
the JVM parameter <code>--add-opens java.base/java.lang=ALL-UNNAMED</code> in order to enable aspect weaving. This is due to the
fact that the weaver uses internal APIs for which we have not found an adequate replacement yet when defining classes
in different classloaders.</p>
</div>
<div class="paragraph">
<p><strong>Update:</strong> As of AspectJ 1.9.21.1, <code>--add-opens</code> is no longer necessary. Please upgrade, if it bothers you too much.</p>
</div>
</div>
<div class="sect3">
<h4 id="_compile_with_java_preview_features">Compile with Java preview features</h4>
<div class="paragraph">
<p>For features marked as preview on a given JDK, you need to compile with <code>ajc --enable-preview</code> and run with
<code>java --enable-preview</code> on that JDK.</p>
</div>
<div class="paragraph">
<p>Please note, that you cannot run code compiled with preview features on any other JDK than the one used for compilation.
For example, records compiled with preview on JDK 15 cannot be used on JDK 16 without recompilation. This is a JVM
limitation unrelated to AspectJ. Also, e.g. sealed classes are preview-1 on JDK 15 and preview-2 on JDK 16. You still
need to recompile, no matter what.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</body>
</html>